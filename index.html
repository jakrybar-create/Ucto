<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PodvojnÃ© ÃºÄtovnÃ­ctvo â€” COFIM</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <style>* { box-sizing: border-box; margin: 0; padding: 0; } body { background: #0b0f1a; color: #f9fafb; }</style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel" data-presets="react">
    const { useState, useEffect, useCallback, useRef } = React;

// â”€â”€ helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const STORAGE_KEY = "podvojne-uctovnictvo-v3";
const fmt = (n) => new Intl.NumberFormat("sk-SK", { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(n ?? 0);
const today = () => new Date().toISOString().slice(0, 10);

const ACCOUNT_CHART = [
  // â”€â”€ TRIEDA 0 â€” DlhodobÃ½ majetok â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  { code: "011", name: "ZriaÄovacie nÃ¡klady", type: "A" },
  { code: "012", name: "NehmotnÃ© vÃ½sledky vÃ½skumu a vÃ½voja", type: "A" },
  { code: "013", name: "SoftvÃ©r", type: "A" },
  { code: "014", name: "OceniteÄ¾nÃ© prÃ¡va", type: "A" },
  { code: "015", name: "Goodwill", type: "A" },
  { code: "019", name: "OstatnÃ½ dlhodobÃ½ nehmotnÃ½ majetok", type: "A" },
  { code: "021", name: "Stavby", type: "A" },
  { code: "022", name: "SamostatnÃ© hnuteÄ¾nÃ© veci a sÃºbory hnuteÄ¾nÃ½ch vecÃ­", type: "A" },
  { code: "023", name: "DopravnÃ© prostriedky", type: "A" },
  { code: "025", name: "PestovateÄ¾skÃ© celky trvalÃ½ch porastov", type: "A" },
  { code: "026", name: "ZÃ¡kladnÃ© stÃ¡do a Å¥aÅ¾nÃ© zvieratÃ¡", type: "A" },
  { code: "029", name: "OstatnÃ½ dlhodobÃ½ hmotnÃ½ majetok", type: "A" },
  { code: "031", name: "Pozemky", type: "A" },
  { code: "032", name: "UmeleckÃ© diela a zbierky", type: "A" },
  { code: "041", name: "Obstaranie dlhodobÃ©ho nehmotnÃ©ho majetku", type: "A" },
  { code: "042", name: "Obstaranie dlhodobÃ©ho hmotnÃ©ho majetku", type: "A" },
  { code: "043", name: "Obstaranie dlhodobÃ©ho finanÄnÃ©ho majetku", type: "A" },
  { code: "051", name: "PoskytnutÃ© preddavky na DNM", type: "A" },
  { code: "052", name: "PoskytnutÃ© preddavky na DHM", type: "A" },
  { code: "053", name: "PoskytnutÃ© preddavky na DFM", type: "A" },
  { code: "061", name: "PodielovÃ© cennÃ© papiere a podiely v ovlÃ¡danÃ½ch osobÃ¡ch", type: "A" },
  { code: "062", name: "PodielovÃ© CP a podiely v spoloÄnostiach s podstatnÃ½m vplyvom", type: "A" },
  { code: "063", name: "RealizovateÄ¾nÃ© cennÃ© papiere a podiely", type: "A" },
  { code: "065", name: "DlhovÃ© cennÃ© papiere drÅ¾anÃ© do splatnosti", type: "A" },
  { code: "066", name: "PÃ´Å¾iÄky ovlÃ¡danÃ½m osobÃ¡m a osobÃ¡m s podstatnÃ½m vplyvom", type: "A" },
  { code: "067", name: "OstatnÃ© pÃ´Å¾iÄky", type: "A" },
  { code: "069", name: "OstatnÃ½ dlhodobÃ½ finanÄnÃ½ majetok", type: "A" },
  { code: "071", name: "OprÃ¡vky k zriaÄovacÃ­m nÃ¡kladom", type: "A" },
  { code: "072", name: "OprÃ¡vky k nehmotnÃ½m vÃ½sledkom vÃ½skumu a vÃ½voja", type: "A" },
  { code: "073", name: "OprÃ¡vky k softvÃ©ru", type: "A" },
  { code: "074", name: "OprÃ¡vky k oceniteÄ¾nÃ½m prÃ¡vam", type: "A" },
  { code: "075", name: "OprÃ¡vky ku goodwillu", type: "A" },
  { code: "079", name: "OprÃ¡vky k ostatnÃ©mu DNM", type: "A" },
  { code: "081", name: "OprÃ¡vky k stavbÃ¡m", type: "A" },
  { code: "082", name: "OprÃ¡vky k samostatnÃ½m hnuteÄ¾nÃ½m veciam", type: "A" },
  { code: "083", name: "OprÃ¡vky k dopravnÃ½m prostriedkom", type: "A" },
  { code: "085", name: "OprÃ¡vky k pestovateÄ¾skÃ½m celkom trvalÃ½ch porastov", type: "A" },
  { code: "086", name: "OprÃ¡vky k zÃ¡kladnÃ©mu stÃ¡du a Å¥aÅ¾nÃ½m zvieratÃ¡m", type: "A" },
  { code: "089", name: "OprÃ¡vky k ostatnÃ©mu DHM", type: "A" },
  { code: "091", name: "OpravnÃ¡ poloÅ¾ka k nadobudnutÃ©mu majetku", type: "A" },
  { code: "092", name: "OpravnÃ¡ poloÅ¾ka k DHM", type: "A" },
  { code: "093", name: "OpravnÃ¡ poloÅ¾ka k nedokonÄenÃ©mu NM", type: "A" },
  { code: "094", name: "OpravnÃ¡ poloÅ¾ka k nedokonÄenÃ©mu HM", type: "A" },
  { code: "095", name: "OpravnÃ¡ poloÅ¾ka k poskytnutÃ½m preddavkom na DM", type: "A" },
  { code: "096", name: "OpravnÃ¡ poloÅ¾ka k DFM", type: "A" },
  // â”€â”€ TRIEDA 1 â€” ZÃ¡soby â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  { code: "111", name: "Obstaranie materiÃ¡lu", type: "A" },
  { code: "112", name: "MateriÃ¡l na sklade", type: "A" },
  { code: "119", name: "MateriÃ¡l na ceste", type: "A" },
  { code: "121", name: "NedokonÄenÃ¡ vÃ½roba", type: "A" },
  { code: "122", name: "Polotovary vlastnej vÃ½roby", type: "A" },
  { code: "123", name: "VÃ½robky", type: "A" },
  { code: "124", name: "ZvieratÃ¡", type: "A" },
  { code: "131", name: "Obstaranie tovaru", type: "A" },
  { code: "132", name: "Tovar na sklade a v predajniach", type: "A" },
  { code: "139", name: "Tovar na ceste", type: "A" },
  { code: "191", name: "OpravnÃ¡ poloÅ¾ka k materiÃ¡lu", type: "A" },
  { code: "192", name: "OpravnÃ¡ poloÅ¾ka k nedokonÄenej vÃ½robe", type: "A" },
  { code: "193", name: "OpravnÃ¡ poloÅ¾ka k polotovarom vlastnej vÃ½roby", type: "A" },
  { code: "194", name: "OpravnÃ¡ poloÅ¾ka k vÃ½robkom", type: "A" },
  { code: "195", name: "OpravnÃ¡ poloÅ¾ka k zvieratÃ¡m", type: "A" },
  { code: "196", name: "OpravnÃ¡ poloÅ¾ka k tovaru", type: "A" },
  // â”€â”€ TRIEDA 2 â€” FinanÄnÃ© ÃºÄty â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  { code: "211", name: "Pokladnica", type: "A" },
  { code: "213", name: "Ceniny", type: "A" },
  { code: "221", name: "BankovÃ© ÃºÄty", type: "A" },
  { code: "231", name: "KrÃ¡tkodobÃ© bankovÃ© Ãºvery", type: "P" },
  { code: "232", name: "EskontnÃ© Ãºvery", type: "P" },
  { code: "241", name: "EmitovanÃ© krÃ¡tkodobÃ© dlhopisy", type: "P" },
  { code: "249", name: "OstatnÃ© krÃ¡tkodobÃ© finanÄnÃ© vÃ½pomoci", type: "P" },
  { code: "251", name: "MajetkovÃ© cennÃ© papiere na obchodovanie", type: "A" },
  { code: "253", name: "DlhovÃ© cennÃ© papiere na obchodovanie", type: "A" },
  { code: "255", name: "VlastnÃ© akcie a vlastnÃ© obchodnÃ© podiely", type: "A" },
  { code: "256", name: "DlhovÃ© cennÃ© papiere so splatnosÅ¥ou do 1 roka", type: "A" },
  { code: "257", name: "OstatnÃ© realizovateÄ¾nÃ© cennÃ© papiere", type: "A" },
  { code: "259", name: "Obstaranie krÃ¡tkodobÃ©ho finanÄnÃ©ho majetku", type: "A" },
  { code: "261", name: "Peniaze na ceste", type: "A" },
  { code: "291", name: "OpravnÃ¡ poloÅ¾ka ku krÃ¡tkodobÃ©mu FM", type: "A" },
  // â”€â”€ TRIEDA 3 â€” ZÃºÄtovacie vzÅ¥ahy â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  { code: "311", name: "PohÄ¾adÃ¡vky z obchodnÃ©ho styku", type: "A" },
  { code: "312", name: "Zmenky na inkaso", type: "A" },
  { code: "313", name: "PohÄ¾adÃ¡vky za eskontovanÃ© cennÃ© papiere", type: "A" },
  { code: "314", name: "PoskytnutÃ© preddavky â€” krÃ¡tkodobÃ©", type: "A" },
  { code: "315", name: "OstatnÃ© pohÄ¾adÃ¡vky", type: "A" },
  { code: "316", name: "ÄŒistÃ¡ hodnota zÃ¡kazky", type: "A" },
  { code: "321", name: "ZÃ¡vÃ¤zky z obchodnÃ©ho styku", type: "P" },
  { code: "322", name: "Zmenky na Ãºhradu", type: "P" },
  { code: "324", name: "PrijatÃ© preddavky â€” krÃ¡tkodobÃ©", type: "P" },
  { code: "325", name: "OstatnÃ© zÃ¡vÃ¤zky", type: "P" },
  { code: "326", name: "NevyfakturovanÃ© dodÃ¡vky", type: "P" },
  { code: "331", name: "ZÃ¡vÃ¤zky voÄi zamestnancom", type: "P" },
  { code: "333", name: "OstatnÃ© zÃ¡vÃ¤zky voÄi zamestnancom", type: "P" },
  { code: "335", name: "PohÄ¾adÃ¡vky voÄi zamestnancom", type: "A" },
  { code: "336", name: "ZÃ¡vÃ¤zky na sociÃ¡lne a zdravotnÃ© poistenie", type: "P" },
  { code: "341", name: "DaÅˆ z prÃ­jmov", type: "P" },
  { code: "342", name: "OstatnÃ© priame dane", type: "P" },
  { code: "343", name: "DaÅˆ z pridanej hodnoty", type: "P" },
  { code: "345", name: "OstatnÃ© dane a poplatky", type: "P" },
  { code: "346", name: "DotÃ¡cie zo Å¡tÃ¡tneho rozpoÄtu", type: "P" },
  { code: "347", name: "OstatnÃ© dotÃ¡cie", type: "P" },
  { code: "351", name: "PohÄ¾adÃ¡vky v rÃ¡mci konsolidovanÃ©ho celku", type: "A" },
  { code: "352", name: "PohÄ¾adÃ¡vky voÄi spoloÄnÃ­kom a zdruÅ¾eniu", type: "A" },
  { code: "353", name: "PohÄ¾adÃ¡vky za upÃ­sanÃ© vlastnÃ© imanie", type: "A" },
  { code: "354", name: "PohÄ¾adÃ¡vky voÄi ÃºÄastnÃ­kom zdruÅ¾enia", type: "A" },
  { code: "355", name: "OstatnÃ© pohÄ¾adÃ¡vky voÄi spoloÄnÃ­kom", type: "A" },
  { code: "358", name: "PohÄ¾adÃ¡vky voÄi spoloÄnÃ­kom pri zlÃºÄenÃ­", type: "A" },
  { code: "361", name: "ZÃ¡vÃ¤zky v rÃ¡mci konsolidovanÃ©ho celku", type: "P" },
  { code: "362", name: "ZÃ¡vÃ¤zky voÄi spoloÄnÃ­kom a zdruÅ¾eniu", type: "P" },
  { code: "364", name: "ZÃ¡vÃ¤zky voÄi ÃºÄastnÃ­kom zdruÅ¾enia", type: "P" },
  { code: "365", name: "OstatnÃ© zÃ¡vÃ¤zky voÄi spoloÄnÃ­kom", type: "P" },
  { code: "366", name: "ZÃ¡vÃ¤zky voÄi spoloÄnÃ­kom pri zlÃºÄenÃ­", type: "P" },
  { code: "367", name: "ZÃ¡vÃ¤zky z upÃ­sanÃ½ch nesplatenÃ½ch CP a vkladov", type: "P" },
  { code: "368", name: "ZÃ¡vÃ¤zky z emisie dlhopisov", type: "P" },
  { code: "371", name: "PohÄ¾adÃ¡vky z predaja podniku", type: "A" },
  { code: "372", name: "ZÃ¡vÃ¤zky z kÃºpy podniku", type: "P" },
  { code: "373", name: "PohÄ¾adÃ¡vky a zÃ¡vÃ¤zky z pevnÃ½ch termÃ­novÃ½ch operÃ¡ciÃ­", type: "A" },
  { code: "374", name: "PohÄ¾adÃ¡vky z opciÃ­", type: "A" },
  { code: "375", name: "OstatnÃ© pohÄ¾adÃ¡vky", type: "A" },
  { code: "376", name: "NakÃºpenÃ© opcie", type: "A" },
  { code: "377", name: "PredanÃ© opcie", type: "P" },
  { code: "378", name: "OstatnÃ© zÃ¡vÃ¤zky", type: "P" },
  { code: "381", name: "NÃ¡klady budÃºcich obdobÃ­ â€” krÃ¡tkodobÃ©", type: "A" },
  { code: "382", name: "KomplexnÃ© nÃ¡klady budÃºcich obdobÃ­", type: "A" },
  { code: "383", name: "VÃ½davky budÃºcich obdobÃ­ â€” krÃ¡tkodobÃ©", type: "P" },
  { code: "384", name: "VÃ½nosy budÃºcich obdobÃ­ â€” krÃ¡tkodobÃ©", type: "P" },
  { code: "385", name: "PrÃ­jmy budÃºcich obdobÃ­ â€” krÃ¡tkodobÃ©", type: "A" },
  { code: "391", name: "OpravnÃ¡ poloÅ¾ka k pohÄ¾adÃ¡vkam", type: "A" },
  // â”€â”€ TRIEDA 4 â€” KapitÃ¡lovÃ© ÃºÄty a dlhodobÃ© zÃ¡vÃ¤zky â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  { code: "411", name: "ZÃ¡kladnÃ© imanie", type: "P" },
  { code: "412", name: "EmisnÃ© Ã¡Å¾io", type: "P" },
  { code: "413", name: "OstatnÃ© kapitÃ¡lovÃ© fondy", type: "P" },
  { code: "414", name: "OceÅˆovacie rozdiely z precenenia majetku a zÃ¡vÃ¤zkov", type: "P" },
  { code: "415", name: "OceÅˆovacie rozdiely z kapitÃ¡lovÃ½ch ÃºÄastÃ­n", type: "P" },
  { code: "416", name: "OceÅˆovacie rozdiely z precenenia pri zlÃºÄenÃ­", type: "P" },
  { code: "417", name: "ZÃ¡konnÃ½ rezervnÃ½ fond", type: "P" },
  { code: "418", name: "NedeliteÄ¾nÃ½ fond", type: "P" },
  { code: "419", name: "OstatnÃ© fondy zo zisku", type: "P" },
  { code: "421", name: "ZÃ¡konnÃ½ rezervnÃ½ fond z kapitÃ¡lovÃ½ch vkladov", type: "P" },
  { code: "422", name: "OstatnÃ© fondy", type: "P" },
  { code: "423", name: "Å tatutÃ¡rne fondy", type: "P" },
  { code: "427", name: "OstatnÃ© fondy", type: "P" },
  { code: "428", name: "NerozdelenÃ½ zisk minulÃ½ch rokov", type: "P" },
  { code: "429", name: "NeuhradenÃ¡ strata minulÃ½ch rokov", type: "P" },
  { code: "431", name: "VÃ½sledok hospodÃ¡renia v schvaÄ¾ovanÃ­", type: "P" },
  { code: "451", name: "Rezervy zÃ¡konnÃ©", type: "P" },
  { code: "452", name: "OstatnÃ© rezervy", type: "P" },
  { code: "453", name: "Rezerva na daÅˆ z prÃ­jmov", type: "P" },
  { code: "461", name: "BankovÃ© Ãºvery", type: "P" },
  { code: "471", name: "DlhodobÃ© zÃ¡vÃ¤zky z obchodnÃ©ho styku", type: "P" },
  { code: "472", name: "DlhodobÃ© prijatÃ© preddavky", type: "P" },
  { code: "473", name: "VydanÃ© dlhopisy", type: "P" },
  { code: "474", name: "ZÃ¡vÃ¤zky z nÃ¡jmu", type: "P" },
  { code: "475", name: "DlhodobÃ© zÃ¡vÃ¤zky voÄi zamestnancom", type: "P" },
  { code: "476", name: "DlhodobÃ© zÃ¡vÃ¤zky voÄi spoloÄnÃ­kom", type: "P" },
  { code: "478", name: "DlhodobÃ© zmenky na Ãºhradu", type: "P" },
  { code: "479", name: "OstatnÃ© dlhodobÃ© zÃ¡vÃ¤zky", type: "P" },
  { code: "481", name: "OdloÅ¾enÃ½ daÅˆovÃ½ zÃ¡vÃ¤zok a pohÄ¾adÃ¡vka", type: "P" },
  { code: "491", name: "VlastnÃ© imanie fyzickej osoby â€” podnikateÄ¾a", type: "P" },
  // â”€â”€ TRIEDA 5 â€” NÃ¡klady â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  { code: "501", name: "Spotreba materiÃ¡lu", type: "N" },
  { code: "502", name: "Spotreba energie", type: "N" },
  { code: "503", name: "Spotreba ostatnÃ½ch neskladovateÄ¾nÃ½ch dodÃ¡vok", type: "N" },
  { code: "504", name: "PredanÃ½ tovar", type: "N" },
  { code: "511", name: "Opravy a udrÅ¾iavanie", type: "N" },
  { code: "512", name: "CestovnÃ©", type: "N" },
  { code: "513", name: "NÃ¡klady na reprezentÃ¡ciu", type: "N" },
  { code: "518", name: "OstatnÃ© sluÅ¾by", type: "N" },
  { code: "521", name: "MzdovÃ© nÃ¡klady", type: "N" },
  { code: "522", name: "PrÃ­jmy spoloÄnÃ­kov a Älenov zo zÃ¡vislej Äinnosti", type: "N" },
  { code: "523", name: "Odmeny Älenom orgÃ¡nov spoloÄnosti a druÅ¾stva", type: "N" },
  { code: "524", name: "ZÃ¡konnÃ© sociÃ¡lne poistenie", type: "N" },
  { code: "525", name: "OstatnÃ© sociÃ¡lne poistenie", type: "N" },
  { code: "526", name: "SociÃ¡lne nÃ¡klady individuÃ¡lneho podnikateÄ¾a", type: "N" },
  { code: "527", name: "ZÃ¡konnÃ© sociÃ¡lne nÃ¡klady", type: "N" },
  { code: "528", name: "OstatnÃ© sociÃ¡lne nÃ¡klady", type: "N" },
  { code: "531", name: "DaÅˆ z motorovÃ½ch vozidiel", type: "N" },
  { code: "532", name: "DaÅˆ z nehnuteÄ¾nostÃ­", type: "N" },
  { code: "538", name: "OstatnÃ© dane a poplatky", type: "N" },
  { code: "541", name: "ZostatkovÃ¡ cena predanÃ©ho DHM a DNM", type: "N" },
  { code: "542", name: "PredanÃ½ materiÃ¡l", type: "N" },
  { code: "543", name: "Dary", type: "N" },
  { code: "544", name: "ZmluvnÃ© pokuty a penÃ¡le", type: "N" },
  { code: "545", name: "OstatnÃ© pokuty a penÃ¡le", type: "N" },
  { code: "546", name: "Odpis pohÄ¾adÃ¡vky", type: "N" },
  { code: "548", name: "OstatnÃ© nÃ¡klady na hospodÃ¡rsku ÄinnosÅ¥", type: "N" },
  { code: "549", name: "MankÃ¡ a Å¡kody", type: "N" },
  { code: "551", name: "Odpisy dlhodobÃ©ho nehmotnÃ©ho a hmotnÃ©ho majetku", type: "N" },
  { code: "552", name: "ZostatkovÃ¡ cena predanÃ©ho DFM", type: "N" },
  { code: "553", name: "PredanÃ© CP a podiely", type: "N" },
  { code: "554", name: "PredanÃ© nehnuteÄ¾nosti a hnuteÄ¾nÃ© veci ako DFM", type: "N" },
  { code: "555", name: "Tvorba a zÃºÄtovanie opravnÃ½ch poloÅ¾iek k DFM", type: "N" },
  { code: "556", name: "Tvorba a zÃºÄtovanie opravnÃ½ch poloÅ¾iek ku krÃ¡tkodobÃ©mu FM", type: "N" },
  { code: "557", name: "NÃ¡klady na krÃ¡tkodobÃ½ finanÄnÃ½ majetok", type: "N" },
  { code: "558", name: "Tvorba a zÃºÄtovanie opravnÃ½ch poloÅ¾iek z finanÄnej Äinnosti", type: "N" },
  { code: "561", name: "PredanÃ© CP a podiely", type: "N" },
  { code: "562", name: "Ãšroky", type: "N" },
  { code: "563", name: "KurzovÃ© straty", type: "N" },
  { code: "564", name: "NÃ¡klady z precenenia CP", type: "N" },
  { code: "565", name: "NÃ¡klady z DFM", type: "N" },
  { code: "566", name: "NÃ¡klady z krÃ¡tkodobÃ©ho FM", type: "N" },
  { code: "567", name: "NÃ¡klady na derivÃ¡tovÃ© operÃ¡cie", type: "N" },
  { code: "568", name: "OstatnÃ© nÃ¡klady na finanÄnÃº ÄinnosÅ¥", type: "N" },
  { code: "569", name: "MankÃ¡ a Å¡kody na finanÄnom majetku", type: "N" },
  { code: "571", name: "Mimoriadne nÃ¡klady", type: "N" },
  { code: "574", name: "Tvorba a zÃºÄtovanie rezerv", type: "N" },
  { code: "575", name: "Tvorba a zÃºÄtovanie opravnÃ½ch poloÅ¾iek", type: "N" },
  { code: "576", name: "Tvorba a zÃºÄtovanie opravnÃ½ch poloÅ¾iek z finanÄnej Äinnosti", type: "N" },
  { code: "577", name: "Tvorba a zÃºÄtovanie opravnÃ½ch poloÅ¾iek z mimoriadnej Äinnosti", type: "N" },
  { code: "578", name: "Tvorba a zÃºÄtovanie opravnÃ½ch poloÅ¾iek k zÃ¡sobÃ¡m", type: "N" },
  { code: "581", name: "NÃ¡klady na zmenu stavu vnÃºtroorganizaÄnÃ½ch zÃ¡sob", type: "N" },
  { code: "582", name: "AktivÃ¡cia materiÃ¡lu a tovaru", type: "N" },
  { code: "583", name: "AktivÃ¡cia vnÃºtroorganizaÄnÃ½ch sluÅ¾ieb", type: "N" },
  { code: "584", name: "AktivÃ¡cia dlhodobÃ©ho nehmotnÃ©ho majetku", type: "N" },
  { code: "585", name: "AktivÃ¡cia dlhodobÃ©ho hmotnÃ©ho majetku", type: "N" },
  { code: "591", name: "DaÅˆ z prÃ­jmov z beÅ¾nej Äinnosti â€” splatnÃ¡", type: "N" },
  { code: "592", name: "DaÅˆ z prÃ­jmov z beÅ¾nej Äinnosti â€” odloÅ¾enÃ¡", type: "N" },
  { code: "593", name: "DaÅˆ z prÃ­jmov z mimoriadnej Äinnosti â€” splatnÃ¡", type: "N" },
  { code: "594", name: "DaÅˆ z prÃ­jmov z mimoriadnej Äinnosti â€” odloÅ¾enÃ¡", type: "N" },
  { code: "595", name: "DodatoÄnÃ© odvody dane z prÃ­jmov", type: "N" },
  // â”€â”€ TRIEDA 6 â€” VÃ½nosy â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  { code: "601", name: "TrÅ¾by za vlastnÃ© vÃ½robky", type: "V" },
  { code: "602", name: "TrÅ¾by z predaja sluÅ¾ieb", type: "V" },
  { code: "603", name: "TrÅ¾by za predaj poÄ¾nohospodÃ¡rskych vÃ½robkov", type: "V" },
  { code: "604", name: "TrÅ¾by za predanÃ½ tovar", type: "V" },
  { code: "611", name: "Zmena stavu nedokonÄenej vÃ½roby", type: "V" },
  { code: "612", name: "Zmena stavu polotovarov vlastnej vÃ½roby", type: "V" },
  { code: "613", name: "Zmena stavu vÃ½robkov", type: "V" },
  { code: "614", name: "Zmena stavu zvieratÃ¡", type: "V" },
  { code: "621", name: "AktivÃ¡cia materiÃ¡lu a tovaru", type: "V" },
  { code: "622", name: "AktivÃ¡cia vnÃºtroorganizaÄnÃ½ch sluÅ¾ieb", type: "V" },
  { code: "623", name: "AktivÃ¡cia dlhodobÃ©ho nehmotnÃ©ho majetku", type: "V" },
  { code: "624", name: "AktivÃ¡cia dlhodobÃ©ho hmotnÃ©ho majetku", type: "V" },
  { code: "641", name: "TrÅ¾by z predaja DHM a DNM", type: "V" },
  { code: "642", name: "TrÅ¾by z predaja materiÃ¡lu", type: "V" },
  { code: "643", name: "ZmluvnÃ© pokuty a penÃ¡le", type: "V" },
  { code: "644", name: "OstatnÃ© pokuty a penÃ¡le", type: "V" },
  { code: "645", name: "Odpis zÃ¡vÃ¤zku", type: "V" },
  { code: "646", name: "VÃ½nosy z odpÃ­sanÃ½ch pohÄ¾adÃ¡vok", type: "V" },
  { code: "648", name: "OstatnÃ© vÃ½nosy z hospodÃ¡rskej Äinnosti", type: "V" },
  { code: "649", name: "InÃ© ostatnÃ© vÃ½nosy z hospodÃ¡rskej Äinnosti", type: "V" },
  { code: "651", name: "TrÅ¾by z predaja CP a podielov", type: "V" },
  { code: "652", name: "VÃ½nosy z DFM", type: "V" },
  { code: "653", name: "VÃ½nosy z krÃ¡tkodobÃ©ho FM", type: "V" },
  { code: "654", name: "VÃ½nosy z precenenia CP", type: "V" },
  { code: "655", name: "VÃ½nosy sÃºvisiace s DFM", type: "V" },
  { code: "656", name: "VÃ½nosy z predaja nehnuteÄ¾nostÃ­ ako DFM", type: "V" },
  { code: "657", name: "VÃ½nosy z derivÃ¡tovÃ½ch operÃ¡ciÃ­", type: "V" },
  { code: "661", name: "TrÅ¾by z predaja CP a podielov â€” krÃ¡tkodobÃ½ FM", type: "V" },
  { code: "662", name: "Ãšroky", type: "V" },
  { code: "663", name: "KurzovÃ© zisky", type: "V" },
  { code: "664", name: "VÃ½nosy z precenenia CP a derivÃ¡tov", type: "V" },
  { code: "665", name: "VÃ½nosy z DFM", type: "V" },
  { code: "666", name: "VÃ½nosy z krÃ¡tkodobÃ©ho FM", type: "V" },
  { code: "667", name: "VÃ½nosy z derivÃ¡tovÃ½ch operÃ¡ciÃ­", type: "V" },
  { code: "668", name: "OstatnÃ© vÃ½nosy z finanÄnej Äinnosti", type: "V" },
  { code: "671", name: "Mimoriadne vÃ½nosy", type: "V" },
  { code: "688", name: "OstatnÃ© mimoriadne vÃ½nosy", type: "V" },
  // â”€â”€ TRIEDA 7 â€” UzÃ¡vierkovÃ© a podsÃºvahovÃ© ÃºÄty â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  { code: "701", name: "ZaÄiatoÄnÃ½ ÃºÄet sÃºvahovÃ½", type: "Z" },
  { code: "702", name: "KoneÄnÃ½ ÃºÄet sÃºvahovÃ½", type: "Z" },
  { code: "710", name: "ÃšÄet ziskov a strÃ¡t", type: "Z" },
];

const typeLabel = { A: "AktÃ­va", P: "PasÃ­va", N: "NÃ¡klady", V: "VÃ½nosy" };
const typeColor = { A: "#4ade80", P: "#f472b6", N: "#f87171", V: "#60a5fa" };

function emptyYear() { return { entries: [], openingBalances: {} }; }

function guessType(code) {
  const n = parseInt(code);
  if (n >= 700 && n <= 799) return "Z"; // uzÃ¡vierkovÃ© ÃºÄty
  if (n >= 100 && n <= 299) return "A";
  if (n >= 300 && n <= 499) return "P";
  if (n >= 500 && n <= 599) return "N";
  if (n >= 600 && n <= 699) return "V";
  return "A";
}

function calcLedger(entries, openingBalances) {
  const ob0 = openingBalances ?? {};
  const ledger = {};
  for (const acc of ACCOUNT_CHART) {
    if (!ledger[acc.code]) {
      const ob = ob0[acc.code] ?? { debit: 0, credit: 0 };
      ledger[acc.code] = { ...acc, debit: ob.debit, credit: ob.credit };
    }
  }
  for (const e of entries) {
    for (const code of [e.debitAcc, e.creditAcc]) {
      if (code && !ledger[code]) {
        const ob = ob0[code] ?? { debit: 0, credit: 0 };
        ledger[code] = { code, name: code, type: guessType(code), debit: ob.debit, credit: ob.credit };
      }
    }
  }
  for (const e of entries) {
    if (e.debitAcc && ledger[e.debitAcc]) ledger[e.debitAcc].debit += e.amount;
    if (e.creditAcc && ledger[e.creditAcc]) ledger[e.creditAcc].credit += e.amount;
  }
  return ledger;
}

function balance(acc) {
  return (acc.type === "A" || acc.type === "N") ? acc.debit - acc.credit : acc.credit - acc.debit;
}

// â”€â”€ AI helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function callClaude(messages, systemPrompt) {
  let response;
  try {
    response = await fetch("https://api.anthropic.com/v1/messages", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        model: "claude-sonnet-4-20250514",
        max_tokens: 8000,
        system: systemPrompt,
        messages,
      }),
    });
  } catch (networkErr) {
    throw new Error(`SieÅ¥ovÃ¡ chyba: ${networkErr.message}. Skontrolujte pripojenie na internet.`);
  }

  // Read raw text first so we can always show what came back
  let rawText;
  try { rawText = await response.text(); } catch (_) { rawText = ""; }

  if (!response.ok) {
    let detail = `HTTP ${response.status}`;
    try { const e = JSON.parse(rawText); detail = e?.error?.message ?? rawText.slice(0, 300); } catch (_) { detail = rawText.slice(0, 300) || `HTTP ${response.status}`; }
    throw new Error(detail);
  }

  let data;
  try { data = JSON.parse(rawText); }
  catch (_) { throw new Error(`Server vrÃ¡til neplatnÃ½ JSON (${response.status}): ${rawText.slice(0, 200)}`); }

  if (data.error) throw new Error(data.error.message ?? JSON.stringify(data.error));
  if (!data.content || !Array.isArray(data.content)) throw new Error(`ChÃ½ba pole 'content' v odpovedi. OdpoveÄ: ${rawText.slice(0, 200)}`);
  return data.content.map(b => b.text ?? "").join("");
}

// Extract text from PDF using PDF.js (loaded from CDN)
async function extractPdfText(file, onProgress) {
  // Dynamically load PDF.js if not already loaded
  if (!window.pdfjsLib) {
    await new Promise((res, rej) => {
      const s = document.createElement("script");
      s.src = "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js";
      s.onload = res; s.onerror = () => rej(new Error("Nepodarilo sa naÄÃ­taÅ¥ PDF.js kniÅ¾nicu"));
      document.head.appendChild(s);
    });
    window.pdfjsLib.GlobalWorkerOptions.workerSrc =
      "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";
  }

  const arrayBuffer = await file.arrayBuffer();
  const pdf = await window.pdfjsLib.getDocument({ data: arrayBuffer }).promise;
  const totalPages = pdf.numPages;
  let fullText = "";

  for (let i = 1; i <= totalPages; i++) {
    if (onProgress) onProgress(`ÄŒÃ­tam stranu ${i} / ${totalPages}â€¦`);
    const page = await pdf.getPage(i);
    const tc = await page.getTextContent();
    const pageText = tc.items.map(item => item.str).join(" ");
    fullText += `\n--- Strana ${i} ---\n${pageText}`;
    // Safety cap: ~300k chars is plenty for accounting journals
    if (fullText.length > 300_000) {
      fullText += "\n[Dokument skrÃ¡tenÃ½ â€” ÄalÅ¡Ã­ obsah presiahol limit]";
      break;
    }
  }
  return { text: fullText, pages: totalPages };
}

async function callClaudeWithText(text, systemPrompt) {
  return callClaude([{
    role: "user",
    content: `Tu je obsah ÃºÄtovnÃ©ho dokumentu:\n\n${text}\n\nExtraktuj vÅ¡etky ÃºÄtovnÃ© zÃ¡znamy. VrÃ¡Å¥ IBA JSON bez markdown. KaÅ¾dÃ½ zÃ¡znam musÃ­ maÅ¥: date, description, debitAcc, creditAcc, amount.`
  }], systemPrompt);
}

// Recover entries even from a truncated/broken JSON string.
// Uses bracket-scanning to extract individual { } blocks and parses each one
// independently â€” handles field-order variation and special characters correctly.
function recoverEntries(raw) {
  const clean = raw.replace(/```json|```/g, "").trim();

  // 1. Fast path: try a normal parse first
  try {
    const parsed = JSON.parse(clean);
    return { year: String(parsed.year ?? ""), entries: parsed.entries ?? [], wasRecovered: false };
  } catch (_) {}

  // 2. Extract year from anywhere in the text
  const yearMatch = clean.match(/"year"\s*:\s*"(\d{4})"/);
  const year = yearMatch ? yearMatch[1] : "";

  // 3. Start scanning after the "entries" key to skip the outer wrapper object
  const arrIdx = clean.indexOf('"entries"');
  const searchFrom = arrIdx >= 0 ? arrIdx : 0;

  // 4. Bracket-scan: find balanced { } blocks respecting strings + escapes
  const entries = [];
  let depth = 0;
  let blockStart = -1;
  let inString = false;
  let esc = false;

  for (let i = searchFrom; i < clean.length; i++) {
    const ch = clean[i];
    if (esc)               { esc = false; continue; }
    if (ch === "\\" && inString) { esc = true;  continue; }
    if (ch === '"')        { inString = !inString; continue; }
    if (inString)          { continue; }

    if (ch === "{") {
      if (depth === 0) blockStart = i;
      depth++;
    } else if (ch === "}") {
      depth--;
      if (depth === 0 && blockStart >= 0) {
        const block = clean.slice(blockStart, i + 1);
        try {
          const obj = JSON.parse(block);
          // Accept any object that has the essential accounting fields
          if (obj.date && (obj.debitAcc || obj.debit_acc) && (obj.creditAcc || obj.credit_acc)) {
            entries.push({
              date:        String(obj.date ?? ""),
              description: String(obj.description ?? obj.desc ?? obj.popis ?? ""),
              debitAcc:    String(obj.debitAcc ?? obj.debit_acc ?? obj.md ?? ""),
              creditAcc:   String(obj.creditAcc ?? obj.credit_acc ?? obj.d ?? ""),
              amount:      parseFloat(obj.amount ?? obj.suma ?? obj.sum ?? 0) || 0,
            });
          }
        } catch (_) { /* malformed block â€” skip */ }
        blockStart = -1;
      }
    }
  }

  if (entries.length === 0) {
    throw new Error(
      "Nepodarilo sa extrahovaÅ¥ zÃ¡znamy z odpovede AI. " +
      "SkÃºste menÅ¡Ã­ PDF (odporÃºÄame max. ~50 strÃ¡n na jeden import)."
    );
  }
  return { year, entries, wasRecovered: true };
}

const ACCT_LIST = ACCOUNT_CHART.map(a => `${a.code}: ${a.name} (${typeLabel[a.type]})`).join("\n");

const PDF_SYSTEM = `Si expertnÃ½ slovenskÃ½ ÃºÄtovnÃ­k. AnalyzujeÅ¡ ÃºÄtovnÃ© doklady a extraktujeÅ¡ zÃ¡znamy do Å¡truktÃºrovanÃ©ho JSON.

DostupnÃ© ÃºÄty:\n${ACCT_LIST}

PravidlÃ¡:
- PrÃ­jmy na bank. ÃºÄet: MD 221, D 6xx
- VÃ½daje z bank. ÃºÄtu: MD 5xx, D 221
- Mzdy: MD 521, D 331
- Dane: MD 341, D 221
- VrÃ¡Å¥ IBA validnÃ½ JSON, Å¾iadny inÃ½ text ani markdown backticks

FormÃ¡t: {"year":"RRRR","entries":[{"date":"RRRR-MM-DD","description":"...","debitAcc":"XXX","creditAcc":"YYY","amount":0.00}]}`;

const XML_SYSTEM = `Si expertnÃ½ slovenskÃ½ ÃºÄtovnÃ­k. AnalyzujeÅ¡ bankovÃ½ vÃ½pis v XML a konvertujeÅ¡ transakcie na ÃºÄtovnÃ© zÃ¡znamy.

DostupnÃ© ÃºÄty:\n${ACCT_LIST}

Mapovanie:
- PrÃ­jem (CRDT): MD 221, D podÄ¾a popisu (Ãºrokâ†’648b, trÅ¾byâ†’602, ostatnÃ©â†’648)
- VÃ½daj (DBIT): D 221, MD podÄ¾a popisu (mzdaâ†’521, nÃ¡jomâ†’511, mat.â†’501, daÅˆâ†’341, ostatnÃ©â†’501)
- VrÃ¡Å¥ IBA validnÃ½ JSON, Å¾iadny inÃ½ text ani markdown backticks

FormÃ¡t: {"year":"RRRR","entries":[{"date":"RRRR-MM-DD","description":"...","debitAcc":"XXX","creditAcc":"YYY","amount":0.00}]}`;

// â”€â”€ Reusable UI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function Tag({ type }) {
  return (
    <span style={{
      background: typeColor[type] + "22", color: typeColor[type],
      border: `1px solid ${typeColor[type]}44`,
      borderRadius: 4, padding: "1px 6px", fontSize: 11, fontWeight: 700, letterSpacing: 1
    }}>{typeLabel[type]}</span>
  );
}

function Modal({ title, onClose, children, wide }) {
  return (
    <div style={{
      position: "fixed", inset: 0, background: "rgba(0,0,0,.8)", backdropFilter: "blur(6px)",
      display: "flex", alignItems: "center", justifyContent: "center", zIndex: 1000, padding: 20
    }} onClick={onClose}>
      <div onClick={e => e.stopPropagation()} style={{
        background: "#111827", border: "1px solid #374151", borderRadius: 16,
        padding: 32, width: wide ? "min(900px,96vw)" : "min(560px,96vw)",
        maxHeight: "92vh", overflowY: "auto",
        boxShadow: "0 30px 80px rgba(0,0,0,.85)"
      }}>
        <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 24 }}>
          <span style={{ fontFamily: "'Playfair Display',serif", fontSize: 20, color: "#f9fafb" }}>{title}</span>
          <button onClick={onClose} style={{ background: "none", border: "none", color: "#9ca3af", cursor: "pointer", fontSize: 24, lineHeight: 1 }}>Ã—</button>
        </div>
        {children}
      </div>
    </div>
  );
}

function DropZone({ accept, onFile, label, sublabel, icon, color }) {
  const ref = useRef();
  const [drag, setDrag] = useState(false);
  const handle = (f) => { if (f) onFile(f); };
  return (
    <div onClick={() => ref.current.click()}
      onDragOver={e => { e.preventDefault(); setDrag(true); }}
      onDragLeave={() => setDrag(false)}
      onDrop={e => { e.preventDefault(); setDrag(false); handle(e.dataTransfer.files[0]); }}
      style={{
        border: `2px dashed ${drag ? color : "#374151"}`,
        borderRadius: 14, padding: "36px 20px", textAlign: "center",
        cursor: "pointer", transition: "all .2s",
        background: drag ? color + "11" : "#0d1117",
      }}>
      <input ref={ref} type="file" accept={accept} style={{ display: "none" }} onChange={e => handle(e.target.files[0])} />
      <div style={{ fontSize: 44, marginBottom: 12 }}>{icon}</div>
      <div style={{ color: "#e5e7eb", fontSize: 14, fontWeight: 600, marginBottom: 4 }}>{label}</div>
      <div style={{ color: "#4b5563", fontSize: 12 }}>{sublabel || "Kliknite alebo presuÅˆte sÃºbor sem"}</div>
    </div>
  );
}

function Spinner({ color = "#10b981" }) {
  return (
    <div style={{ textAlign: "center", padding: "50px 0" }}>
      <div style={{ fontSize: 52, marginBottom: 20, animation: "spin 2s linear infinite", display: "inline-block" }}>âš™ï¸</div>
      <style>{`@keyframes spin{to{transform:rotate(360deg)}} @keyframes bar{0%{transform:translateX(-100%)}100%{transform:translateX(350%)}}`}</style>
      <div style={{ height: 3, background: "#1f2937", borderRadius: 2, overflow: "hidden", width: "60%", margin: "0 auto" }}>
        <div style={{ height: "100%", background: `linear-gradient(90deg, ${color}, #818cf8)`, animation: "bar 1.4s infinite", width: "45%" }} />
      </div>
    </div>
  );
}

function PreviewTable({ entries, selected, onToggle, onToggleAll }) {
  const all = entries.length > 0 && entries.every((_, i) => selected[i]);
  return (
    <div style={{ borderRadius: 10, overflow: "hidden", border: "1px solid #1f2937", maxHeight: 360, overflowY: "auto" }}>
      <table style={{ width: "100%", borderCollapse: "collapse", fontSize: 12 }}>
        <thead style={{ background: "#0a0e18", position: "sticky", top: 0, zIndex: 1 }}>
          <tr>
            <th style={{ padding: "9px 10px", textAlign: "center", borderBottom: "1px solid #1f2937" }}>
              <input type="checkbox" checked={all} onChange={() => onToggleAll(!all)} />
            </th>
            {["DÃ¡tum","Popis","MD","D","Suma â‚¬"].map(h => (
              <th key={h} style={{ padding: "9px 10px", color: "#6b7280", textAlign: "left", fontWeight: 600, fontSize: 11, letterSpacing: 0.8, textTransform: "uppercase", borderBottom: "1px solid #1f2937" }}>{h}</th>
            ))}
          </tr>
        </thead>
        <tbody>
          {entries.map((e, i) => (
            <tr key={i} style={{ opacity: selected[i] ? 1 : 0.3, transition: "opacity .15s" }}>
              <td style={{ padding: "7px 10px", textAlign: "center", borderBottom: "1px solid #0d1117" }}>
                <input type="checkbox" checked={!!selected[i]} onChange={() => onToggle(i)} />
              </td>
              <td style={{ padding: "7px 10px", color: "#9ca3af", borderBottom: "1px solid #0d1117", whiteSpace: "nowrap" }}>{e.date}</td>
              <td style={{ padding: "7px 10px", color: "#e5e7eb", borderBottom: "1px solid #0d1117", maxWidth: 260, overflow: "hidden", textOverflow: "ellipsis", whiteSpace: "nowrap" }} title={e.description}>{e.description}</td>
              <td style={{ padding: "7px 10px", color: "#4ade80", borderBottom: "1px solid #0d1117", fontWeight: 600 }}>{e.debitAcc}</td>
              <td style={{ padding: "7px 10px", color: "#f472b6", borderBottom: "1px solid #0d1117", fontWeight: 600 }}>{e.creditAcc}</td>
              <td style={{ padding: "7px 10px", color: "#10b981", fontWeight: 700, textAlign: "right", borderBottom: "1px solid #0d1117", whiteSpace: "nowrap" }}>{fmt(e.amount)}</td>
            </tr>
          ))}
          {entries.length === 0 && (
            <tr><td colSpan={6} style={{ padding: 30, textAlign: "center", color: "#4b5563" }}>Å½iadne zÃ¡znamy</td></tr>
          )}
        </tbody>
      </table>
    </div>
  );
}

// â”€â”€ PDF IMPORT MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// â”€â”€ OCR Doklad Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function OcrModal({ onClose, onConfirm, inp, btn, year }) {
  const [stage, setStage] = useState("capture"); // capture | processing | review
  const [imgB64, setImgB64] = useState(null);
  const [imgPreview, setImgPreview] = useState(null);
  const [result, setResult] = useState(null);
  const [error, setError] = useState("");
  const [form, setForm] = useState({ date: "", description: "", debitAcc: "", creditAcc: "", amount: "" });
  const fileRef = useRef(null);

  const ACCOUNTS_LIST = ACCOUNT_CHART.map(a => `${a.code} â€“ ${a.name}`).join("\n");

  const handleFile = (file) => {
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (e) => {
      const dataUrl = e.target.result;
      const b64 = dataUrl.split(",")[1];
      setImgB64(b64);
      setImgPreview(dataUrl);
      setStage("processing");
      processImage(b64);
    };
    reader.readAsDataURL(file);
  };

  const processImage = async (b64) => {
    setError("");
    try {
      const res = await fetch("https://api.anthropic.com/v1/messages", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          model: "claude-sonnet-4-20250514",
          max_tokens: 1000,
          system: `Si ÃºÄtovnÃ½ asistent pre slovenskÃ© podvojnÃ© ÃºÄtovnÃ­ctvo. 
Z odfotenÃ©ho dokladu (faktÃºra, pokladniÄnÃ½ doklad, vÃ½pis) extrahuj ÃºÄtovnÃ½ zÃ¡pis.
DostupnÃ© ÃºÄty:
${ACCOUNTS_LIST}

Odpovedz VÃLUÄŒNE JSON objektom (bez markdown, bez textu navyÅ¡e):
{
  "date": "YYYY-MM-DD",
  "description": "struÄnÃ½ popis",
  "debitAcc": "XXX",
  "creditAcc": "XXX", 
  "amount": 0.00,
  "confidence": "high|medium|low",
  "notes": "vysvetlenie alebo otÃ¡zky"
}`,
          messages: [{
            role: "user",
            content: [
              { type: "image", source: { type: "base64", media_type: "image/jpeg", data: b64 } },
              { type: "text", text: `AktuÃ¡lny rok: ${year}. Extrahuj ÃºÄtovnÃ½ zÃ¡pis z tohto dokladu.` }
            ]
          }]
        })
      });

      const data = await res.json();
      if (!res.ok) throw new Error(data.error?.message || "API chyba");

      const text = data.content?.map(b => b.text || "").join("") || "";
      const clean = text.replace(/```json|```/g, "").trim();
      const parsed = JSON.parse(clean);

      setResult(parsed);
      setForm({
        date: parsed.date || new Date().toISOString().slice(0, 10),
        description: parsed.description || "",
        debitAcc: parsed.debitAcc || "",
        creditAcc: parsed.creditAcc || "",
        amount: parsed.amount ? String(parsed.amount) : "",
      });
      setStage("review");
    } catch (e) {
      setError("Chyba OCR: " + e.message);
      setStage("capture");
    }
  };

  const confidenceColor = { high: "#10b981", medium: "#f59e0b", low: "#f87171" };
  const confidenceLabel = { high: "VysokÃ¡ istota", medium: "StrednÃ¡ istota", low: "NÃ­zka istota â€” skontrolujte" };

  const sectionTitle = (t) => (
    <div style={{ fontSize: 10, letterSpacing: 1, textTransform: "uppercase", color: "#6b7280", marginBottom: 6, marginTop: 14 }}>{t}</div>
  );

  return (
    <Modal title="ğŸ“· OCR â€” NahraÅ¥ doklad" onClose={onClose}>
      {stage === "capture" && (
        <div>
          <div style={{ textAlign: "center", padding: "20px 0" }}>
            <div style={{ fontSize: 52, marginBottom: 12 }}>ğŸ“„</div>
            <div style={{ color: "#9ca3af", fontSize: 13, marginBottom: 20 }}>
              Odfote doklad kamerou alebo vyberte obrÃ¡zok z galÃ©rie.<br />
              <span style={{ fontSize: 11, color: "#6b7280" }}>FaktÃºra, pokladniÄnÃ½ doklad, vÃ½pis z ÃºÄtu</span>
            </div>
            <div style={{ display: "flex", flexDirection: "column", gap: 10, alignItems: "center" }}>
              <button
                onClick={() => { fileRef.current.setAttribute("capture","environment"); fileRef.current.click(); }}
                style={{ ...btn("#7c3aed"), padding: "12px 28px", fontSize: 14, width: "100%", maxWidth: 280 }}
              >
                ğŸ“· OdfotiÅ¥ kamerou
              </button>
              <button
                onClick={() => { fileRef.current.removeAttribute("capture"); fileRef.current.click(); }}
                style={{ ...btn("#374151"), padding: "10px 28px", fontSize: 13, width: "100%", maxWidth: 280 }}
              >
                ğŸ–¼ VybraÅ¥ z galÃ©rie
              </button>
            </div>
            <input
              ref={fileRef}
              type="file"
              accept="image/*"
              style={{ display: "none" }}
              onChange={e => handleFile(e.target.files[0])}
            />
          </div>
          {error && (
            <div style={{ background: "#1f0d0d", border: "1px solid #7f1d1d", borderRadius: 8, padding: "10px 14px", color: "#f87171", fontSize: 12, marginTop: 8 }}>
              {error}
              <div style={{ marginTop: 8 }}>
                <button onClick={() => setError("")} style={{ ...btn("#374151"), padding: "4px 12px", fontSize: 11 }}>SkÃºsiÅ¥ znova</button>
              </div>
            </div>
          )}
        </div>
      )}

      {stage === "processing" && (
        <div style={{ textAlign: "center", padding: "30px 0" }}>
          {imgPreview && (
            <img src={imgPreview} alt="doklad"
              style={{ maxWidth: "100%", maxHeight: 200, borderRadius: 8, marginBottom: 20, objectFit: "contain", border: "1px solid #1f2937" }} />
          )}
          <div style={{ fontSize: 32, marginBottom: 12 }}>
            <span style={{ display: "inline-block", animation: "spin 1s linear infinite" }}>âš™ï¸</span>
          </div>
          <div style={{ color: "#9ca3af", fontSize: 13 }}>Claude analyzuje dokladâ€¦</div>
          <div style={{ color: "#6b7280", fontSize: 11, marginTop: 6 }}>RozpoznÃ¡vanie textu a kontextu</div>
          <style>{`@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }`}</style>
        </div>
      )}

      {stage === "review" && result && (
        <div>
          <div style={{ display: "flex", gap: 10, marginBottom: 14, alignItems: "flex-start" }}>
            {imgPreview && (
              <img src={imgPreview} alt="doklad"
                style={{ width: 80, height: 80, borderRadius: 6, objectFit: "cover", border: "1px solid #1f2937", flexShrink: 0 }} />
            )}
            <div style={{ flex: 1 }}>
              <div style={{ display: "flex", alignItems: "center", gap: 8, marginBottom: 6 }}>
                <span style={{ fontSize: 11, fontWeight: 700, color: confidenceColor[result.confidence] || "#9ca3af",
                  background: (confidenceColor[result.confidence] || "#9ca3af") + "22",
                  padding: "3px 8px", borderRadius: 4 }}>
                  â— {confidenceLabel[result.confidence] || result.confidence}
                </span>
              </div>
              {result.notes && (
                <div style={{ fontSize: 11, color: "#9ca3af", fontStyle: "italic", lineHeight: 1.4 }}>{result.notes}</div>
              )}
            </div>
          </div>

          {sectionTitle("Skontrolujte a upravte pred uloÅ¾enÃ­m")}

          {[{ label: "DÃ¡tum", key: "date", type: "date" },
            { label: "Popis", key: "description", type: "text", placeholder: "Popis operÃ¡cie" }
          ].map(f => (
            <div key={f.key} style={{ marginBottom: 12 }}>
              <label style={{ display: "block", fontSize: 10, color: "#6b7280", marginBottom: 3, letterSpacing: 1, textTransform: "uppercase" }}>{f.label}</label>
              <input type={f.type} value={form[f.key]} placeholder={f.placeholder}
                onChange={e => setForm(x => ({ ...x, [f.key]: e.target.value }))} style={inp} />
            </div>
          ))}

          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10, marginBottom: 12 }}>
            {[{ label: "MD ÃºÄet", key: "debitAcc", color: "#4ade80" },
              { label: "D ÃºÄet", key: "creditAcc", color: "#f472b6" }
            ].map(f => (
              <div key={f.key}>
                <label style={{ display: "block", fontSize: 10, color: f.color, marginBottom: 3, letterSpacing: 1, textTransform: "uppercase" }}>{f.label}</label>
                <select value={form[f.key]} onChange={e => setForm(x => ({ ...x, [f.key]: e.target.value }))} style={inp}>
                  <option value="">â€” vybraÅ¥ â€”</option>
                  {ACCOUNT_CHART.map(a => <option key={a.code} value={a.code}>{a.code} â€“ {a.name}</option>)}
                </select>
              </div>
            ))}
          </div>

          <div style={{ marginBottom: 16 }}>
            <label style={{ display: "block", fontSize: 10, color: "#6b7280", marginBottom: 3, letterSpacing: 1, textTransform: "uppercase" }}>Suma (â‚¬)</label>
            <input type="number" value={form.amount} placeholder="0.00"
              onChange={e => setForm(x => ({ ...x, amount: e.target.value }))} style={inp} />
          </div>

          <div style={{ display: "flex", justifyContent: "space-between", gap: 8, flexWrap: "wrap" }}>
            <button onClick={() => { setStage("capture"); setImgB64(null); setImgPreview(null); }}
              style={{ ...btn("#374151"), fontSize: 12 }}>â† NovÃ½ doklad</button>
            <div style={{ display: "flex", gap: 8 }}>
              <button onClick={onClose} style={{ ...btn("#374151"), fontSize: 12 }}>ZruÅ¡iÅ¥</button>
              <button
                onClick={() => {
                  if (!form.date || !form.debitAcc || !form.creditAcc || !form.amount) {
                    alert("VyplÅˆte vÅ¡etky povinnÃ© polia"); return;
                  }
                  onConfirm(form);
                }}
                style={{ ...btn("#7c3aed"), fontSize: 12 }}
              >
                âœ“ PouÅ¾iÅ¥ zÃ¡pis
              </button>
            </div>
          </div>
        </div>
      )}
    </Modal>
  );
}

function PdfImportModal({ onClose, onImport, inp, btn }) {
  const [stage, setStage] = useState("upload");
  const [error, setError] = useState("");
  const [preview, setPreview] = useState(null);
  const [selected, setSelected] = useState({});
  const [targetYear, setTargetYear] = useState("");
  const [recovered, setRecovered] = useState(false);
  const [processLog, setProcessLog] = useState("ÄŒÃ­tam PDF sÃºborâ€¦");

  const process = async (file) => {
    setStage("processing");
    setRecovered(false);
    setProcessLog("Inicializujem PDF kniÅ¾nicuâ€¦");
    try {
      // Step 1: Extract text from PDF using PDF.js (no base64 transfer!)
      const { text, pages } = await extractPdfText(file, (msg) => setProcessLog(msg));

      if (!text.trim()) {
        throw new Error("PDF neobsahuje ÄitateÄ¾nÃ½ text. MoÅ¾no je to naskenovanÃ½ obrÃ¡zok bez OCR vrstvy.");
      }

      setProcessLog(`Extrahovalo sa ${pages} strÃ¡n textu. Analyzujem s AIâ€¦`);

      // Step 2: Send extracted text to Claude (much smaller than base64 PDF)
      const CHUNK = 120_000; // ~120k chars per request is safe
      let allEntries = [];
      let detectedYear = "";
      let wasRecov = false;

      if (text.length <= CHUNK) {
        // Single request
        const raw = await callClaudeWithText(text, PDF_SYSTEM);
        const result = recoverEntries(raw);
        allEntries = result.entries;
        detectedYear = result.year;
        wasRecov = result.wasRecovered ?? false;
      } else {
        // Split into chunks for very long documents
        const chunks = [];
        for (let i = 0; i < text.length; i += CHUNK) chunks.push(text.slice(i, i + CHUNK));
        for (let ci = 0; ci < chunks.length; ci++) {
          setProcessLog(`AI analyzuje ÄasÅ¥ ${ci + 1} / ${chunks.length}â€¦`);
          try {
            const raw = await callClaudeWithText(chunks[ci], PDF_SYSTEM);
            const result = recoverEntries(raw);
            // Deduplicate
            const seen = new Set(allEntries.map(e => `${e.date}|${e.description}|${e.amount}`));
            const fresh = result.entries.filter(e => !seen.has(`${e.date}|${e.description}|${e.amount}`));
            allEntries.push(...fresh);
            if (!detectedYear && result.year) detectedYear = result.year;
            if (result.wasRecovered) wasRecov = true;
          } catch (_) { /* skip failed chunk, continue */ }
        }
        wasRecov = chunks.length > 1;
      }

      if (allEntries.length === 0) {
        throw new Error("AI nenaÅ¡la Å¾iadne ÃºÄtovnÃ© zÃ¡znamy v dokumente. Uistite sa, Å¾e PDF obsahuje ÃºÄtovnÃ½ dennÃ­k alebo podobnÃ½ vÃ½kaz.");
      }

      const entries = allEntries.map(e => ({ ...e, amount: parseFloat(e.amount) || 0 }));
      if (wasRecov) setRecovered(true);
      setPreview({ entries });
      setTargetYear(detectedYear);
      setSelected(Object.fromEntries(entries.map((_, i) => [i, true])));
      setStage("preview");
    } catch (e) {
      setError(e.message);
      setStage("error");
    }
  };

  const confirm = () => {
    if (!targetYear) return;
    const sel = preview.entries
      .filter((_, i) => selected[i])
      .map(e => ({ id: Date.now() + Math.random(), ...e }));
    onImport(targetYear, sel);
  };

  return (
    <Modal title="ğŸ“„ Import z PDF dokumentu" onClose={onClose} wide>
      {stage === "upload" && (
        <div>
          <div style={{ marginBottom: 20, padding: 14, background: "#0d1117", borderRadius: 10, fontSize: 13, color: "#9ca3af", lineHeight: 1.8 }}>
            Nahrajte <strong style={{ color: "#f9fafb" }}>PDF ÃºÄtovnÃ½ vÃ½kaz</strong> z minulÃ½ch rokov.
            AI automaticky rozoznÃ¡ a extraktuje zÃ¡znamy z dennÃ­ka, hlavnej knihy alebo inÃ½ch ÃºÄtovnÃ½ch vÃ½stupov.
          </div>
          <DropZone
            accept=".pdf"
            onFile={process}
            label="PresuÅˆte PDF sem alebo kliknite pre vÃ½ber"
            sublabel="PodporovanÃ©: vÃ½pisy z Pohody, Money S3, OMEGA, KROS, vlastnÃ© PDF"
            icon="ğŸ“„"
            color="#f59e0b"
          />
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: 10, marginTop: 16 }}>
            {[
              { icon: "ğŸ—‚", label: "ÃšÄtovnÃ½ dennÃ­k", desc: "Zoznamy ÃºÄtovnÃ½ch zÃ¡pisov" },
              { icon: "ğŸ“š", label: "HlavnÃ¡ kniha", desc: "Obraty a zostatky ÃºÄtov" },
              { icon: "ğŸ“‹", label: "SÃºvaha / VÃ½sledovka", desc: "RoÄnÃ© vÃ½kazy" },
            ].map(c => (
              <div key={c.label} style={{ padding: 12, background: "#0d1117", borderRadius: 8, border: "1px solid #1f2937", textAlign: "center" }}>
                <div style={{ fontSize: 22, marginBottom: 6 }}>{c.icon}</div>
                <div style={{ fontSize: 12, color: "#e5e7eb", fontWeight: 600 }}>{c.label}</div>
                <div style={{ fontSize: 11, color: "#4b5563", marginTop: 3 }}>{c.desc}</div>
              </div>
            ))}
          </div>
        </div>
      )}

      {stage === "processing" && (
        <div>
          <div style={{ fontFamily: "'Playfair Display',serif", fontSize: 18, textAlign: "center", marginBottom: 8 }}>AI analyzuje dokumentâ€¦</div>
          <div style={{ color: "#6b7280", fontSize: 13, textAlign: "center", marginBottom: 24 }}>{processLog}</div>
          <Spinner color="#f59e0b" />
          <div style={{ textAlign: "center", marginTop: 20, fontSize: 11, color: "#374151" }}>
            VeÄ¾kÃ© PDF (100+ strÃ¡n) mÃ´Å¾e trvaÅ¥ 30â€“60 sekÃºnd
          </div>
        </div>
      )}

      {stage === "error" && (
        <div style={{ textAlign: "center", padding: "20px 0" }}>
          <div style={{ fontSize: 48, marginBottom: 16 }}>âš ï¸</div>
          <div style={{ color: "#f87171", marginBottom: 12, fontSize: 15, fontWeight: 700 }}>Chyba pri spracovanÃ­</div>
          <div style={{ color: "#9ca3af", fontSize: 13, marginBottom: 16, background: "#0d1117", padding: "10px 14px", borderRadius: 8, border: "1px solid #1f2937", textAlign: "left", wordBreak: "break-word" }}>{error}</div>
          <div style={{ fontSize: 12, color: "#4b5563", marginBottom: 20 }}>
            Tipy: PDF nesmie byÅ¥ zaheslovanÃ© Â· Max. odporÃºÄanÃ¡ veÄ¾kosÅ¥ ~10 MB Â· NaskenovanÃ© PDF bez OCR nemusÃ­ fungovaÅ¥
          </div>
          <button onClick={() => { setStage("upload"); setError(""); }} style={btn("#374151")}>â† SkÃºsiÅ¥ znova</button>
        </div>
      )}

      {stage === "preview" && preview && (
        <div>
          {recovered && (
            <div style={{ marginBottom: 14, padding: "10px 14px", background: "#f59e0b11", border: "1px solid #f59e0b55", borderRadius: 8, fontSize: 12, color: "#f59e0b", display: "flex", gap: 8 }}>
              <span style={{ flexShrink: 0 }}>âš </span>
              <span>OdpoveÄ AI bola skrÃ¡tenÃ¡ â€” zÃ¡znamy boli ÄiastoÄne obnovenÃ© ({preview.entries.length} ks). Overte, Äi nechÃ½bajÃº poloÅ¾ky. Pre veÄ¾kÃ© PDF odporÃºÄame rozdeliÅ¥ sÃºbor na menÅ¡ie Äasti.</span>
            </div>
          )}
          <div style={{ display: "flex", alignItems: "center", justifyContent: "space-between", marginBottom: 14, flexWrap: "wrap", gap: 10 }}>
            <div style={{ fontSize: 14, color: "#9ca3af" }}>
              AI extraktovala <strong style={{ color: "#f59e0b" }}>{preview.entries.length}</strong> zÃ¡znamov.
              OdznaÄte zÃ¡znamy, ktorÃ© nechcete importovaÅ¥.
            </div>
            <div style={{ display: "flex", alignItems: "center", gap: 8 }}>
              <span style={{ fontSize: 12, color: "#6b7280" }}>ImportovaÅ¥ do roku:</span>
              <input value={targetYear} onChange={e => setTargetYear(e.target.value)}
                placeholder="napr. 2023" style={{ ...inp, width: 100, padding: "6px 10px", fontSize: 13 }} />
            </div>
          </div>
          <PreviewTable entries={preview.entries} selected={selected}
            onToggle={i => setSelected(s => ({ ...s, [i]: !s[i] }))}
            onToggleAll={v => setSelected(Object.fromEntries(preview.entries.map((_, i) => [i, v])))} />
          <div style={{ marginTop: 10, display: "flex", justifyContent: "space-between", alignItems: "center" }}>
            <span style={{ fontSize: 11, color: "#6b7280" }}>
              VybranÃ©: <strong style={{ color: "#f59e0b" }}>{Object.values(selected).filter(Boolean).length}</strong> / {preview.entries.length}
            </span>
            <div style={{ display: "flex", gap: 10 }}>
              <button onClick={onClose} style={btn("#374151")}>ZruÅ¡iÅ¥</button>
              <button onClick={confirm} style={{ ...btn("#f59e0b"), opacity: (!targetYear || Object.values(selected).every(v => !v)) ? 0.4 : 1 }}>
                âœ“ ImportovaÅ¥ ({Object.values(selected).filter(Boolean).length})
              </button>
            </div>
          </div>
        </div>
      )}
    </Modal>
  );
}

// â”€â”€ XML IMPORT MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function XmlImportModal({ onClose, onImport, inp, btn }) {
  const [stage, setStage] = useState("upload");
  const [error, setError] = useState("");
  const [preview, setPreview] = useState(null);
  const [selected, setSelected] = useState({});
  const [targetYear, setTargetYear] = useState("");
  const [useAi, setUseAi] = useState(true);

  const parseXmlFallback = (xmlText) => {
    const parser = new DOMParser();
    const doc = parser.parseFromString(xmlText, "text/xml");
    const entries = [];

    // CAMT.053 / ISO 20022
    const txNodes = doc.querySelectorAll("Ntry");
    txNodes.forEach(node => {
      const amtEl = node.querySelector("Amt");
      const amt = parseFloat(amtEl?.textContent ?? "0");
      const cd = node.querySelector("CdtDbtInd")?.textContent?.trim();
      const dateRaw = node.querySelector("ValDt Dt")?.textContent
        ?? node.querySelector("BookgDt Dt")?.textContent ?? "";
      const desc = node.querySelector("AddtlNtryInf")?.textContent?.trim()
        ?? node.querySelector("Ustrd")?.textContent?.trim()
        ?? node.querySelector("RmtInf Ustrd")?.textContent?.trim()
        ?? "BankovÃ½ pohyb";
      if (!amt || !dateRaw) return;
      const isCredit = cd === "CRDT";
      entries.push({
        date: dateRaw.slice(0, 10),
        description: desc.slice(0, 80),
        debitAcc: isCredit ? "221" : "501",
        creditAcc: isCredit ? "602" : "221",
        amount: Math.abs(amt)
      });
    });

    // Generic fallback
    if (entries.length === 0) {
      doc.querySelectorAll("transaction, pohyb, entry, txn").forEach(r => {
        const amt = r.querySelector("[tag*='amount' i], amount, suma, Amt")?.textContent;
        if (amt && parseFloat(amt)) {
          entries.push({
            date: today(),
            description: r.querySelector("description, popis, desc, name")?.textContent?.slice(0, 80) ?? "Import",
            debitAcc: "221", creditAcc: "602",
            amount: Math.abs(parseFloat(amt.replace(",", ".")))
          });
        }
      });
    }
    return entries;
  };

  const process = async (file) => {
    setStage("processing");
    try {
      const xmlText = await file.text();
      let entries = [];
      let year = "";

      if (useAi) {
        const raw = await callClaude([{
          role: "user",
          content: `BankovÃ½ vÃ½pis v XML (max. 30 000 znakov):\n\n${xmlText.slice(0, 30000)}\n\nExtraktuj vÅ¡etky transakcie. VrÃ¡Å¥ IBA JSON. KaÅ¾dÃ½ zÃ¡znam musÃ­ maÅ¥ polia: date, description, debitAcc, creditAcc, amount.`
        }], XML_SYSTEM);
        const recovered = recoverEntries(raw);
        entries = recovered.entries.map(e => ({ ...e, amount: parseFloat(e.amount) || 0 }));
        year = recovered.year;
      } else {
        entries = parseXmlFallback(xmlText);
        year = entries[0]?.date?.slice(0, 4) ?? "";
      }

      setPreview({ entries });
      setTargetYear(year);
      setSelected(Object.fromEntries(entries.map((_, i) => [i, true])));
      setStage("preview");
    } catch (e) {
      setError(e.message);
      setStage("error");
    }
  };

  const confirm = () => {
    if (!targetYear) return;
    const sel = preview.entries
      .filter((_, i) => selected[i])
      .map(e => ({ id: Date.now() + Math.random(), ...e }));
    onImport(targetYear, sel);
  };

  return (
    <Modal title="ğŸ¦ Import bankovÃ©ho vÃ½pisu (XML)" onClose={onClose} wide>
      {stage === "upload" && (
        <div>
          <div style={{ marginBottom: 20, padding: 14, background: "#0d1117", borderRadius: 10, fontSize: 13, color: "#9ca3af", lineHeight: 1.8 }}>
            Nahrajte <strong style={{ color: "#f9fafb" }}>bankovÃ½ vÃ½pis vo formÃ¡te XML</strong>.
            Automaticky sa rozpoznÃ¡ formÃ¡t CAMT.053, ISO 20022 alebo vlastnÃ½ XML formÃ¡t banky.
          </div>
          <div style={{ display: "flex", alignItems: "center", gap: 12, marginBottom: 16, padding: "12px 16px", background: "#0d1117", borderRadius: 10, border: "1px solid #1f2937" }}>
            <label style={{ display: "flex", alignItems: "center", gap: 8, cursor: "pointer", fontSize: 13 }}>
              <input type="checkbox" checked={useAi} onChange={e => setUseAi(e.target.checked)}
                style={{ width: 16, height: 16, accentColor: "#6366f1" }} />
              <span style={{ color: "#e5e7eb" }}>PouÅ¾iÅ¥ AI interpretÃ¡ciu</span>
            </label>
            <span style={{ fontSize: 11, color: "#4b5563" }}>â€” presnejÅ¡ia klasifikÃ¡cia na ÃºÄty, pomalÅ¡ia</span>
            {!useAi && <span style={{ fontSize: 11, color: "#f59e0b", marginLeft: "auto" }}>âš  RÃ½chly parser (len Å¡tandardnÃ© CAMT)</span>}
          </div>
          <DropZone
            accept=".xml,.camt,.xls"
            onFile={process}
            label="PresuÅˆte XML vÃ½pis sem alebo kliknite pre vÃ½ber"
            sublabel="CAMT.053, ISO 20022, SLSP, VÃšB, Tatra banka, ÄŒSOB, UniCredit"
            icon="ğŸ¦"
            color="#6366f1"
          />
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10, marginTop: 16 }}>
            {[
              { icon: "ğŸ›", label: "CAMT.053", desc: "EurÃ³psky Å¡tandard ISO 20022" },
              { icon: "ğŸ¢", label: "SlovenskÃ© banky", desc: "SLSP, VÃšB, Tatra, ÄŒSOB, OTP" },
            ].map(c => (
              <div key={c.label} style={{ padding: 12, background: "#0d1117", borderRadius: 8, border: "1px solid #1f2937", display: "flex", alignItems: "center", gap: 12 }}>
                <span style={{ fontSize: 28 }}>{c.icon}</span>
                <div>
                  <div style={{ fontSize: 13, color: "#e5e7eb", fontWeight: 600 }}>{c.label}</div>
                  <div style={{ fontSize: 11, color: "#4b5563", marginTop: 2 }}>{c.desc}</div>
                </div>
              </div>
            ))}
          </div>
        </div>
      )}

      {stage === "processing" && (
        <div>
          <div style={{ fontFamily: "'Playfair Display',serif", fontSize: 18, textAlign: "center", marginBottom: 8 }}>
            {useAi ? "AI klasifikuje transakcieâ€¦" : "Parsovanie XMLâ€¦"}
          </div>
          <div style={{ color: "#6b7280", fontSize: 13, textAlign: "center", marginBottom: 24 }}>
            {useAi ? "Mapujem bankovÃ© pohyby na ÃºÄtovnÃ© ÃºÄtyâ€¦" : "ÄŒÃ­tam Å¡truktÃºru CAMT.053â€¦"}
          </div>
          <Spinner color="#6366f1" />
        </div>
      )}

      {stage === "error" && (
        <div style={{ textAlign: "center", padding: "30px 0" }}>
          <div style={{ fontSize: 48, marginBottom: 16 }}>âš ï¸</div>
          <div style={{ color: "#f87171", marginBottom: 8, fontSize: 15 }}>Chyba pri spracovanÃ­</div>
          <div style={{ color: "#6b7280", fontSize: 13, marginBottom: 24 }}>{error}</div>
          <div style={{ display: "flex", gap: 10, justifyContent: "center" }}>
            <button onClick={() => { setStage("upload"); setError(""); }} style={btn("#374151")}>â† SpÃ¤Å¥</button>
            {useAi && <button onClick={() => { setUseAi(false); setStage("upload"); setError(""); }} style={btn("#f59e0b")}>SkÃºsiÅ¥ bez AI</button>}
          </div>
        </div>
      )}

      {stage === "preview" && preview && (
        <div>
          <div style={{ display: "flex", alignItems: "center", justifyContent: "space-between", marginBottom: 14, flexWrap: "wrap", gap: 10 }}>
            <div style={{ fontSize: 14, color: "#9ca3af" }}>
              NÃ¡jdenÃ½ch <strong style={{ color: "#6366f1" }}>{preview.entries.length}</strong> transakciÃ­.
            </div>
            <div style={{ display: "flex", alignItems: "center", gap: 8 }}>
              <span style={{ fontSize: 12, color: "#6b7280" }}>ImportovaÅ¥ do roku:</span>
              <input value={targetYear} onChange={e => setTargetYear(e.target.value)}
                placeholder="napr. 2024" style={{ ...inp, width: 100, padding: "6px 10px", fontSize: 13 }} />
            </div>
          </div>
          <PreviewTable entries={preview.entries} selected={selected}
            onToggle={i => setSelected(s => ({ ...s, [i]: !s[i] }))}
            onToggleAll={v => setSelected(Object.fromEntries(preview.entries.map((_, i) => [i, v])))} />
          <div style={{ marginTop: 10, display: "flex", justifyContent: "space-between", alignItems: "center" }}>
            <span style={{ fontSize: 11, color: "#6b7280" }}>
              VybranÃ©: <strong style={{ color: "#6366f1" }}>{Object.values(selected).filter(Boolean).length}</strong> / {preview.entries.length}
            </span>
            <div style={{ display: "flex", gap: 10 }}>
              <button onClick={onClose} style={btn("#374151")}>ZruÅ¡iÅ¥</button>
              <button onClick={confirm} style={{ ...btn("#6366f1"), opacity: (!targetYear || Object.values(selected).every(v => !v)) ? 0.4 : 1 }}>
                âœ“ ImportovaÅ¥ ({Object.values(selected).filter(Boolean).length})
              </button>
            </div>
          </div>
        </div>
      )}
    </Modal>
  );
}

// â”€â”€ MAIN APP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SEED_DATA = {"year":"2024","entries":[{"id":1,"date":"2024-01-01","description":"VÃ½sledok hospodÃ¡renia","debitAcc":"431","creditAcc":"428","amount":25879.12},{"id":2,"date":"2024-01-01","description":"Prechod z minulÃ©ho roka","debitAcc":"211","creditAcc":"701","amount":10500.39},{"id":3,"date":"2024-01-01","description":"Prechod z minulÃ©ho roka","debitAcc":"221","creditAcc":"701","amount":8007.83},{"id":4,"date":"2024-01-01","description":"Prechod z minulÃ©ho roka","debitAcc":"311","creditAcc":"701","amount":15064.0},{"id":5,"date":"2024-01-01","description":"Prechod z minulÃ©ho roka","debitAcc":"701","creditAcc":"341","amount":2693.1},{"id":6,"date":"2024-01-01","description":"Prechod z minulÃ©ho roka","debitAcc":"701","creditAcc":"411","amount":5000.0},{"id":7,"date":"2024-01-01","description":"Prechod z minulÃ©ho roka","debitAcc":"701","creditAcc":"431","amount":10618.23},{"id":8,"date":"2024-01-01","description":"VÃ½sledok hospodÃ¡renia min. roka","debitAcc":"701","creditAcc":"431","amount":15260.89},{"id":9,"date":"2024-01-02","description":"VÃ½pomoc konateÄ¾a","debitAcc":"249","creditAcc":"221","amount":6450.0},{"id":10,"date":"2024-01-03","description":"PredplatnÃ© Äasopisov - N Press","debitAcc":"518","creditAcc":"321","amount":6.99},{"id":11,"date":"2024-01-03","description":"TelefÃ³n, internet - Orange","debitAcc":"518","creditAcc":"321","amount":51.86},{"id":12,"date":"2024-01-04","description":"Ãšhrada faktÃºry DF-20240001 N Press","debitAcc":"321","creditAcc":"221","amount":6.99},{"id":13,"date":"2024-01-05","description":"Leasing 1/24 - ALD Automotive","debitAcc":"518","creditAcc":"321","amount":447.76},{"id":14,"date":"2024-01-06","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":73.86},{"id":15,"date":"2024-01-08","description":"Inkaso faktÃºry 20230012","debitAcc":"221","creditAcc":"311","amount":400.0},{"id":16,"date":"2024-01-08","description":"Inkaso faktÃºry 20230013","debitAcc":"221","creditAcc":"311","amount":900.0},{"id":17,"date":"2024-01-08","description":"Inkaso faktÃºry 20230014","debitAcc":"221","creditAcc":"311","amount":3764.0},{"id":18,"date":"2024-01-14","description":"KancelÃ¡rske potreby - Alza.sk","debitAcc":"501","creditAcc":"321","amount":6.57},{"id":19,"date":"2024-01-14","description":"Ãšhrada faktÃºry ALD Automotive","debitAcc":"321","creditAcc":"221","amount":447.76},{"id":20,"date":"2024-01-14","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":21.22},{"id":21,"date":"2024-01-15","description":"Ãšhrada faktÃºry Alza.sk","debitAcc":"321","creditAcc":"221","amount":6.57},{"id":22,"date":"2024-01-15","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":557.0},{"id":23,"date":"2024-01-16","description":"Ãšhrada faktÃºry Orange","debitAcc":"321","creditAcc":"221","amount":51.86},{"id":24,"date":"2024-01-29","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":678.0},{"id":25,"date":"2024-01-31","description":"EkonomickÃ© poradenstvo - REINS INVEST","debitAcc":"311","creditAcc":"602","amount":900.0},{"id":26,"date":"2024-01-31","description":"BankovÃ© poplatky","debitAcc":"568","creditAcc":"221","amount":8.0},{"id":27,"date":"2024-02-03","description":"TelefÃ³n, internet - Orange","debitAcc":"518","creditAcc":"321","amount":50.58},{"id":28,"date":"2024-02-03","description":"PredplatnÃ© Äasopisov - N Press","debitAcc":"518","creditAcc":"321","amount":6.99},{"id":29,"date":"2024-02-04","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":6.49},{"id":30,"date":"2024-02-04","description":"Ãšhrada faktÃºry N Press","debitAcc":"321","creditAcc":"221","amount":6.99},{"id":31,"date":"2024-02-07","description":"Inkaso faktÃºry 20240001 REINS","debitAcc":"221","creditAcc":"311","amount":900.0},{"id":32,"date":"2024-02-08","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":76.22},{"id":33,"date":"2024-02-09","description":"Leasing 2/24 - ALD Automotive","debitAcc":"518","creditAcc":"321","amount":447.76},{"id":34,"date":"2024-02-09","description":"Ãšhrada faktÃºry ALD Automotive","debitAcc":"321","creditAcc":"221","amount":447.76},{"id":35,"date":"2024-02-14","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":49.8},{"id":36,"date":"2024-02-16","description":"Ãšhrada faktÃºry Orange","debitAcc":"321","creditAcc":"221","amount":50.58},{"id":37,"date":"2024-02-20","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":76.83},{"id":38,"date":"2024-02-29","description":"EkonomickÃ© poradenstvo - REINS INVEST","debitAcc":"311","creditAcc":"602","amount":900.0},{"id":39,"date":"2024-02-29","description":"BankovÃ© poplatky","debitAcc":"568","creditAcc":"221","amount":8.0},{"id":40,"date":"2024-03-03","description":"TelefÃ³n, internet - Orange","debitAcc":"518","creditAcc":"321","amount":48.87},{"id":41,"date":"2024-03-05","description":"PredplatnÃ© Äasopisov - N Press","debitAcc":"518","creditAcc":"321","amount":6.99},{"id":42,"date":"2024-03-06","description":"OstatnÃ© sluÅ¾by","debitAcc":"518","creditAcc":"221","amount":0.5},{"id":43,"date":"2024-03-06","description":"OstatnÃ© sluÅ¾by","debitAcc":"518","creditAcc":"221","amount":0.5},{"id":44,"date":"2024-03-06","description":"Ãšhrada faktÃºry N Press","debitAcc":"321","creditAcc":"221","amount":6.99},{"id":45,"date":"2024-03-07","description":"Inkaso faktÃºry 20240002 REINS","debitAcc":"221","creditAcc":"311","amount":900.0},{"id":46,"date":"2024-03-13","description":"VÃ½pomoc konateÄ¾a","debitAcc":"249","creditAcc":"221","amount":1500.0},{"id":47,"date":"2024-03-14","description":"Leasing 3/24 - ALD Automotive","debitAcc":"518","creditAcc":"321","amount":448.32},{"id":48,"date":"2024-03-15","description":"PrevÃ¡dzkovÃ½ materiÃ¡l","debitAcc":"501","creditAcc":"211","amount":9.47},{"id":49,"date":"2024-03-18","description":"VÃ½pomoc konateÄ¾a","debitAcc":"249","creditAcc":"221","amount":3700.0},{"id":50,"date":"2024-03-19","description":"Ãšhrada faktÃºry Orange","debitAcc":"321","creditAcc":"221","amount":48.87},{"id":51,"date":"2024-03-27","description":"Ãšhrada faktÃºry ALD Automotive","debitAcc":"321","creditAcc":"221","amount":448.32},{"id":52,"date":"2024-03-27","description":"VrÃ¡tenie vÃ½pomoci konateÄ¾a","debitAcc":"221","creditAcc":"249","amount":3700.0},{"id":53,"date":"2024-03-27","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":83.07},{"id":54,"date":"2024-03-27","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":4.5},{"id":55,"date":"2024-03-30","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":36.7},{"id":56,"date":"2024-03-31","description":"EkonomickÃ© poradenstvo - REINS INVEST","debitAcc":"311","creditAcc":"602","amount":900.0},{"id":57,"date":"2024-03-31","description":"BankovÃ© poplatky","debitAcc":"568","creditAcc":"221","amount":8.0},{"id":58,"date":"2024-04-01","description":"Ãšhrada faktÃºry NÃ¡rodnÃ¡ diaÄ¾niÄnÃ¡","debitAcc":"321","creditAcc":"221","amount":60.0},{"id":59,"date":"2024-04-01","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":79.03},{"id":60,"date":"2024-04-02","description":"PrevÃ¡dzkovÃ½ materiÃ¡l","debitAcc":"501","creditAcc":"325","amount":1685.0},{"id":61,"date":"2024-04-02","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":1685.0},{"id":62,"date":"2024-04-03","description":"DiaÄ¾niÄnÃ© poplatky","debitAcc":"518","creditAcc":"321","amount":60.0},{"id":63,"date":"2024-04-03","description":"TelefÃ³n, internet - Orange","debitAcc":"518","creditAcc":"321","amount":49.56},{"id":64,"date":"2024-04-05","description":"PredplatnÃ© Äasopisov - N Press","debitAcc":"518","creditAcc":"321","amount":6.99},{"id":65,"date":"2024-04-05","description":"OstatnÃ© sluÅ¾by - Anton KrÃ¡Ä¾","debitAcc":"518","creditAcc":"211","amount":25.0},{"id":66,"date":"2024-04-06","description":"Ãšhrada faktÃºry N Press","debitAcc":"321","creditAcc":"221","amount":6.99},{"id":67,"date":"2024-04-08","description":"Leasing 4/24 - ALD Automotive","debitAcc":"518","creditAcc":"321","amount":448.32},{"id":68,"date":"2024-04-08","description":"Inkaso faktÃºry 20240003 REINS","debitAcc":"221","creditAcc":"311","amount":900.0},{"id":69,"date":"2024-04-09","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":17.9},{"id":70,"date":"2024-04-11","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":47.56},{"id":71,"date":"2024-04-11","description":"BankovÃ© poplatky","debitAcc":"568","creditAcc":"221","amount":0.95},{"id":72,"date":"2024-04-11","description":"VÃ½pomoc konateÄ¾a","debitAcc":"249","creditAcc":"221","amount":2500.0},{"id":73,"date":"2024-04-11","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":37.0},{"id":74,"date":"2024-04-11","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":22.0},{"id":75,"date":"2024-04-11","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":81.41},{"id":76,"date":"2024-04-12","description":"VrÃ¡tenie vÃ½pomoci konateÄ¾a","debitAcc":"221","creditAcc":"249","amount":1000.0},{"id":77,"date":"2024-04-12","description":"VrÃ¡tenie vÃ½pomoci konateÄ¾a","debitAcc":"221","creditAcc":"249","amount":2500.0},{"id":78,"date":"2024-04-13","description":"DotÃ¡cia pokladnice","debitAcc":"211","creditAcc":"261","amount":1000.0},{"id":79,"date":"2024-04-13","description":"DotÃ¡cia pokladnice","debitAcc":"261","creditAcc":"221","amount":1000.0},{"id":80,"date":"2024-04-13","description":"BankovÃ© poplatky","debitAcc":"568","creditAcc":"221","amount":3.5},{"id":81,"date":"2024-04-16","description":"ServisnÃ© sluÅ¾by - ALD Automotive","debitAcc":"518","creditAcc":"321","amount":200.0},{"id":82,"date":"2024-04-18","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":148.5},{"id":83,"date":"2024-04-19","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":24.9},{"id":84,"date":"2024-04-21","description":"VrÃ¡tenie nÃ¡kupu plat. kartou","debitAcc":"221","creditAcc":"325","amount":17.5},{"id":85,"date":"2024-04-22","description":"Ãšhrada faktÃºry ALD Automotive","debitAcc":"321","creditAcc":"221","amount":448.32},{"id":86,"date":"2024-04-22","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":55.0},{"id":87,"date":"2024-04-22","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":60.71},{"id":88,"date":"2024-04-22","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":21.0},{"id":89,"date":"2024-04-24","description":"OstatnÃ© sluÅ¾by, licencie - maXXam","debitAcc":"518","creditAcc":"321","amount":400.0},{"id":90,"date":"2024-04-25","description":"VrÃ¡tenie vÃ½pomoci konateÄ¾a","debitAcc":"221","creditAcc":"249","amount":1150.0},{"id":91,"date":"2024-04-25","description":"VrÃ¡tenie vÃ½pomoci konateÄ¾a","debitAcc":"221","creditAcc":"249","amount":500.0},{"id":92,"date":"2024-04-25","description":"Ãšhrada faktÃºry Orange","debitAcc":"321","creditAcc":"221","amount":49.56},{"id":93,"date":"2024-04-25","description":"PrevÃ¡dzkovÃ½ materiÃ¡l","debitAcc":"501","creditAcc":"325","amount":581.5},{"id":94,"date":"2024-04-26","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":24.5},{"id":95,"date":"2024-04-27","description":"VÃ½pomoc konateÄ¾a","debitAcc":"249","creditAcc":"221","amount":3250.0},{"id":96,"date":"2024-04-28","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":63.85},{"id":97,"date":"2024-04-29","description":"VrÃ¡tenie vÃ½pomoci konateÄ¾a","debitAcc":"221","creditAcc":"249","amount":3250.0},{"id":98,"date":"2024-04-30","description":"EkonomickÃ© poradenstvo - REINS INVEST","debitAcc":"311","creditAcc":"602","amount":1105.0},{"id":99,"date":"2024-04-30","description":"BankovÃ© poplatky","debitAcc":"568","creditAcc":"221","amount":8.0},{"id":100,"date":"2024-05-03","description":"TelefÃ³n, internet - Orange","debitAcc":"518","creditAcc":"321","amount":50.76},{"id":101,"date":"2024-05-03","description":"NÃ¡klady na reprezentÃ¡ciu - JAMAE","debitAcc":"513","creditAcc":"211","amount":20.6},{"id":102,"date":"2024-05-06","description":"Leasing 05/24 - ALD Automotive","debitAcc":"518","creditAcc":"321","amount":448.32},{"id":103,"date":"2024-05-06","description":"PredplatnÃ© Äasopisov - N Press","debitAcc":"518","creditAcc":"321","amount":6.99},{"id":104,"date":"2024-05-06","description":"VÃ½pomoc konateÄ¾a","debitAcc":"249","creditAcc":"221","amount":200.0},{"id":105,"date":"2024-05-06","description":"Inkaso faktÃºry 20240004 REINS","debitAcc":"221","creditAcc":"311","amount":1105.0},{"id":106,"date":"2024-05-07","description":"Ãšhrada faktÃºry ALD Automotive servis","debitAcc":"321","creditAcc":"221","amount":200.0},{"id":107,"date":"2024-05-07","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":64.2},{"id":108,"date":"2024-05-07","description":"Ãšhrada faktÃºry N Press","debitAcc":"321","creditAcc":"221","amount":6.99},{"id":109,"date":"2024-05-10","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":61.74},{"id":110,"date":"2024-05-12","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":7.49},{"id":111,"date":"2024-05-12","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":19.9},{"id":112,"date":"2024-05-16","description":"BankovÃ© poplatky","debitAcc":"568","creditAcc":"221","amount":1.62},{"id":113,"date":"2024-05-16","description":"BankovÃ© poplatky","debitAcc":"568","creditAcc":"221","amount":0.03},{"id":114,"date":"2024-05-17","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":31.0},{"id":115,"date":"2024-05-17","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":1.2},{"id":116,"date":"2024-05-17","description":"BankovÃ© poplatky","debitAcc":"568","creditAcc":"221","amount":1.21},{"id":117,"date":"2024-05-17","description":"BankovÃ© poplatky","debitAcc":"568","creditAcc":"221","amount":0.02},{"id":118,"date":"2024-05-17","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":83.05},{"id":119,"date":"2024-05-17","description":"BankovÃ© poplatky","debitAcc":"568","creditAcc":"221","amount":1.21},{"id":120,"date":"2024-05-17","description":"BankovÃ© poplatky","debitAcc":"568","creditAcc":"221","amount":0.02},{"id":121,"date":"2024-05-20","description":"Ãšhrada faktÃºry ALD Automotive","debitAcc":"321","creditAcc":"221","amount":448.32},{"id":122,"date":"2024-05-20","description":"DaÅˆ z prÃ­jmov PO za rok 2023","debitAcc":"341","creditAcc":"221","amount":2693.1},{"id":123,"date":"2024-05-23","description":"VÃ½pomoc konateÄ¾a","debitAcc":"249","creditAcc":"221","amount":550.0},{"id":124,"date":"2024-05-23","description":"VrÃ¡tenie vÃ½pomoci konateÄ¾a","debitAcc":"221","creditAcc":"249","amount":550.0},{"id":125,"date":"2024-05-23","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":21.6},{"id":126,"date":"2024-05-23","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":4.29},{"id":127,"date":"2024-05-24","description":"PrevÃ¡dzkovÃ½ materiÃ¡l","debitAcc":"501","creditAcc":"325","amount":42.82},{"id":128,"date":"2024-05-25","description":"Ãšhrada faktÃºry Orange","debitAcc":"321","creditAcc":"221","amount":50.76},{"id":129,"date":"2024-05-31","description":"EkonomickÃ© poradenstvo - REINS INVEST","debitAcc":"311","creditAcc":"602","amount":1015.0},{"id":130,"date":"2024-05-31","description":"BankovÃ© poplatky","debitAcc":"568","creditAcc":"221","amount":8.0},{"id":131,"date":"2024-06-03","description":"TelefÃ³n, internet - Orange","debitAcc":"518","creditAcc":"321","amount":54.1},{"id":132,"date":"2024-06-04","description":"Leasing 06/24 - ALD Automotive","debitAcc":"518","creditAcc":"321","amount":448.32},{"id":133,"date":"2024-06-04","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":77.42},{"id":134,"date":"2024-06-06","description":"PredplatnÃ© Äasopisov - N Press","debitAcc":"518","creditAcc":"321","amount":6.99},{"id":135,"date":"2024-06-06","description":"Inkaso faktÃºry 20240005 REINS","debitAcc":"221","creditAcc":"311","amount":1015.0},{"id":136,"date":"2024-06-07","description":"Ãšhrada faktÃºry maXXam","debitAcc":"321","creditAcc":"221","amount":400.0},{"id":137,"date":"2024-06-07","description":"Ãšhrada faktÃºry N Press","debitAcc":"321","creditAcc":"221","amount":6.99},{"id":138,"date":"2024-06-08","description":"PracovnÃ© jednanie","debitAcc":"513","creditAcc":"325","amount":778.8},{"id":139,"date":"2024-06-09","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":36.6},{"id":140,"date":"2024-06-11","description":"PrevÃ¡dzkovÃ½ materiÃ¡l - Alza.sk","debitAcc":"501","creditAcc":"321","amount":18.26},{"id":141,"date":"2024-06-11","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":19.9},{"id":142,"date":"2024-06-13","description":"Ãšhrada faktÃºry Alza.sk","debitAcc":"321","creditAcc":"221","amount":18.26},{"id":143,"date":"2024-06-13","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":53.9},{"id":144,"date":"2024-06-13","description":"BankovÃ© poplatky","debitAcc":"568","creditAcc":"221","amount":2.04},{"id":145,"date":"2024-06-13","description":"BankovÃ© poplatky","debitAcc":"568","creditAcc":"221","amount":1.08},{"id":146,"date":"2024-06-13","description":"BankovÃ© poplatky","debitAcc":"568","creditAcc":"221","amount":0.04},{"id":147,"date":"2024-06-13","description":"BankovÃ© poplatky","debitAcc":"568","creditAcc":"221","amount":0.37},{"id":148,"date":"2024-06-14","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":1.2},{"id":149,"date":"2024-06-14","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":31.0},{"id":150,"date":"2024-06-15","description":"BankovÃ© poplatky","debitAcc":"568","creditAcc":"221","amount":2.44},{"id":151,"date":"2024-06-15","description":"BankovÃ© poplatky","debitAcc":"568","creditAcc":"221","amount":0.05},{"id":152,"date":"2024-06-17","description":"PoÅ¡tovnÃ© - SlovenskÃ¡ poÅ¡ta","debitAcc":"518","creditAcc":"211","amount":5.2},{"id":153,"date":"2024-06-17","description":"OstatnÃ© sluÅ¾by - SlovenskÃ¡ poÅ¡ta","debitAcc":"518","creditAcc":"211","amount":6.0},{"id":154,"date":"2024-06-17","description":"CestovnÃ© - SAD Å½ilina","debitAcc":"518","creditAcc":"211","amount":3.9},{"id":155,"date":"2024-06-17","description":"Ãšhrada faktÃºry ALD Automotive","debitAcc":"321","creditAcc":"221","amount":448.32},{"id":156,"date":"2024-06-18","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":2.8},{"id":157,"date":"2024-06-20","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":80.34},{"id":158,"date":"2024-06-25","description":"Ãšhrada faktÃºry Orange","debitAcc":"321","creditAcc":"221","amount":54.1},{"id":159,"date":"2024-06-27","description":"NÃ¡klady na reprezentÃ¡ciu","debitAcc":"513","creditAcc":"211","amount":26.89},{"id":160,"date":"2024-06-27","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":7.49},{"id":161,"date":"2024-06-27","description":"DiaÄ¾niÄnÃ© poplatky","debitAcc":"518","creditAcc":"325","amount":11.5},{"id":162,"date":"2024-06-27","description":"PHM","debitAcc":"501","creditAcc":"325","amount":904.41},{"id":163,"date":"2024-06-28","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":65.9},{"id":164,"date":"2024-06-28","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":24.39},{"id":165,"date":"2024-06-30","description":"EkonomickÃ© poradenstvo - REINS INVEST","debitAcc":"311","creditAcc":"602","amount":1006.0},{"id":166,"date":"2024-06-30","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":11.5},{"id":167,"date":"2024-06-30","description":"BankovÃ© poplatky","debitAcc":"568","creditAcc":"221","amount":8.0},{"id":168,"date":"2024-07-01","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":31.5},{"id":169,"date":"2024-07-01","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":54.27},{"id":170,"date":"2024-07-03","description":"TelefÃ³n, internet - Orange","debitAcc":"518","creditAcc":"321","amount":52.67},{"id":171,"date":"2024-07-04","description":"Leasing 07/24 - ALD Automotive","debitAcc":"518","creditAcc":"321","amount":448.32},{"id":172,"date":"2024-07-04","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":65.11},{"id":173,"date":"2024-07-07","description":"PredplatnÃ© Äasopisov - N Press","debitAcc":"518","creditAcc":"321","amount":7.99},{"id":174,"date":"2024-07-08","description":"Inkaso faktÃºry 20240006 REINS","debitAcc":"221","creditAcc":"311","amount":1006.0},{"id":175,"date":"2024-07-08","description":"Ãšhrada faktÃºry N Press","debitAcc":"321","creditAcc":"221","amount":7.99},{"id":176,"date":"2024-07-10","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":3.0},{"id":177,"date":"2024-07-12","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":79.69},{"id":178,"date":"2024-07-17","description":"Ãšhrada faktÃºry ALD Automotive","debitAcc":"321","creditAcc":"221","amount":448.32},{"id":179,"date":"2024-07-27","description":"Ãšhrada faktÃºry Orange","debitAcc":"321","creditAcc":"221","amount":52.67},{"id":180,"date":"2024-07-29","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":74.67},{"id":181,"date":"2024-07-31","description":"EkonomickÃ© poradenstvo - REINS INVEST","debitAcc":"311","creditAcc":"602","amount":900.0},{"id":182,"date":"2024-07-31","description":"BankovÃ© poplatky","debitAcc":"568","creditAcc":"221","amount":8.0},{"id":183,"date":"2024-08-02","description":"PracovnÃ© jednanie","debitAcc":"513","creditAcc":"221","amount":12.55},{"id":184,"date":"2024-08-03","description":"TelefÃ³n, internet - Orange","debitAcc":"518","creditAcc":"321","amount":48.58},{"id":185,"date":"2024-08-05","description":"Inkaso faktÃºry 20240007 REINS","debitAcc":"221","creditAcc":"311","amount":900.0},{"id":186,"date":"2024-08-06","description":"Leasing 08/24 - ALD Automotive","debitAcc":"518","creditAcc":"321","amount":448.32},{"id":187,"date":"2024-08-07","description":"PredplatnÃ© Äasopisov - N Press","debitAcc":"518","creditAcc":"321","amount":7.99},{"id":188,"date":"2024-08-08","description":"Ãšhrada faktÃºry N Press","debitAcc":"321","creditAcc":"221","amount":7.99},{"id":189,"date":"2024-08-14","description":"Ãšhrada faktÃºry ALD Automotive","debitAcc":"321","creditAcc":"221","amount":448.32},{"id":190,"date":"2024-08-15","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":76.73},{"id":191,"date":"2024-08-15","description":"Ãšhrada faktÃºry Orange","debitAcc":"321","creditAcc":"221","amount":48.58},{"id":192,"date":"2024-08-20","description":"OstatnÃ© sluÅ¾by - SlovenskÃ¡ poÅ¡ta","debitAcc":"518","creditAcc":"211","amount":7.0},{"id":193,"date":"2024-08-27","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":31.0},{"id":194,"date":"2024-08-27","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":71.36},{"id":195,"date":"2024-08-28","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":53.9},{"id":196,"date":"2024-08-28","description":"BankovÃ© poplatky","debitAcc":"568","creditAcc":"221","amount":2.0},{"id":197,"date":"2024-08-28","description":"BankovÃ© poplatky","debitAcc":"568","creditAcc":"221","amount":1.08},{"id":198,"date":"2024-08-28","description":"BankovÃ© poplatky","debitAcc":"568","creditAcc":"221","amount":0.04},{"id":199,"date":"2024-08-29","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":31.0},{"id":200,"date":"2024-08-31","description":"EkonomickÃ© poradenstvo - REINS INVEST","debitAcc":"311","creditAcc":"602","amount":1020.0},{"id":201,"date":"2024-08-31","description":"BankovÃ© poplatky","debitAcc":"568","creditAcc":"221","amount":8.0},{"id":202,"date":"2024-09-03","description":"TelefÃ³n, internet - Orange","debitAcc":"518","creditAcc":"321","amount":54.0},{"id":203,"date":"2024-09-05","description":"Leasing 09/24 - ALD Automotive","debitAcc":"518","creditAcc":"321","amount":448.32},{"id":204,"date":"2024-09-06","description":"Inkaso faktÃºry 20240008 REINS","debitAcc":"221","creditAcc":"311","amount":1020.0},{"id":205,"date":"2024-09-06","description":"Ãšhrada faktÃºry N Press","debitAcc":"321","creditAcc":"221","amount":7.99},{"id":206,"date":"2024-09-07","description":"PredplatnÃ© Äasopisov - N Press","debitAcc":"518","creditAcc":"321","amount":7.99},{"id":207,"date":"2024-09-12","description":"PrevÃ¡dzkovÃ½ materiÃ¡l","debitAcc":"501","creditAcc":"325","amount":1.1},{"id":208,"date":"2024-09-12","description":"PoÅ¡tovnÃ©, prepravnÃ©","debitAcc":"518","creditAcc":"325","amount":4.3},{"id":209,"date":"2024-09-13","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":1.1},{"id":210,"date":"2024-09-13","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":1.5},{"id":211,"date":"2024-09-19","description":"Ãšhrada faktÃºry ALD Automotive","debitAcc":"321","creditAcc":"221","amount":448.32},{"id":212,"date":"2024-09-19","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":76.54},{"id":213,"date":"2024-09-22","description":"PrevÃ¡dzkovÃ½ materiÃ¡l - SeS Bratislava","debitAcc":"501","creditAcc":"211","amount":4.49},{"id":214,"date":"2024-09-23","description":"OstatnÃ© sluÅ¾by - Italy car rent","debitAcc":"518","creditAcc":"321","amount":195.0},{"id":215,"date":"2024-09-23","description":"OstatnÃ© sluÅ¾by - Italy car rent","debitAcc":"518","creditAcc":"321","amount":165.55},{"id":216,"date":"2024-09-23","description":"VrÃ¡tenie vÃ½pomoci konateÄ¾a","debitAcc":"221","creditAcc":"249","amount":800.0},{"id":217,"date":"2024-09-23","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":15.47},{"id":218,"date":"2024-09-24","description":"Ãšhrada faktÃºry Italy car rent","debitAcc":"321","creditAcc":"221","amount":195.0},{"id":219,"date":"2024-09-24","description":"Ãšhrada faktÃºry Italy car rent","debitAcc":"321","creditAcc":"221","amount":165.55},{"id":220,"date":"2024-09-24","description":"Ãšhrada faktÃºry Orange","debitAcc":"321","creditAcc":"221","amount":54.0},{"id":221,"date":"2024-09-30","description":"EkonomickÃ© poradenstvo - REINS INVEST","debitAcc":"311","creditAcc":"602","amount":900.0},{"id":222,"date":"2024-09-30","description":"TrÅ¾by za poskytnutÃ© sluÅ¾by - maXXam","debitAcc":"311","creditAcc":"602","amount":3000.0},{"id":223,"date":"2024-09-30","description":"BankovÃ© poplatky","debitAcc":"568","creditAcc":"221","amount":8.0},{"id":224,"date":"2024-09-30","description":"ZdravotnÃ© poistenie-zamestnÃ¡vateÄ¾ 9/24","debitAcc":"524","creditAcc":"336","amount":16.38},{"id":225,"date":"2024-09-30","description":"HrubÃ© mzdy - dohody 9/24","debitAcc":"521","creditAcc":"331","amount":148.91},{"id":226,"date":"2024-09-30","description":"SociÃ¡lne poistenie-zamestnÃ¡vateÄ¾ 9/24","debitAcc":"524","creditAcc":"336","amount":36.67},{"id":227,"date":"2024-10-03","description":"Leasing 10/24 - ALD Automotive","debitAcc":"518","creditAcc":"321","amount":448.32},{"id":228,"date":"2024-10-03","description":"TelefÃ³n, internet - Orange","debitAcc":"518","creditAcc":"321","amount":51.8},{"id":229,"date":"2024-10-06","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":2.0},{"id":230,"date":"2024-10-08","description":"PredplatnÃ© Äasopisov - N Press","debitAcc":"518","creditAcc":"321","amount":7.99},{"id":231,"date":"2024-10-08","description":"Inkaso faktÃºry 20240009 REINS","debitAcc":"221","creditAcc":"311","amount":900.0},{"id":232,"date":"2024-10-09","description":"Ãšhrada faktÃºry N Press","debitAcc":"321","creditAcc":"221","amount":7.99},{"id":233,"date":"2024-10-09","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":80.64},{"id":234,"date":"2024-10-13","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":34.6},{"id":235,"date":"2024-10-15","description":"VÃ½plata mzdy 9/2024","debitAcc":"331","creditAcc":"211","amount":104.49},{"id":236,"date":"2024-10-15","description":"Ãšhrada soc. a zdrav. poistenia","debitAcc":"336","creditAcc":"221","amount":22.33},{"id":237,"date":"2024-10-15","description":"Ãšhrada dane z prÃ­jmov zÃ¡vislÃ¡ Ä.","debitAcc":"342","creditAcc":"221","amount":24.51},{"id":238,"date":"2024-10-15","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":20.0},{"id":239,"date":"2024-10-16","description":"Ãšhrada faktÃºry ALD Automotive","debitAcc":"321","creditAcc":"221","amount":448.32},{"id":240,"date":"2024-10-17","description":"Ãšhrada soc. poistenia","debitAcc":"336","creditAcc":"221","amount":50.63},{"id":241,"date":"2024-10-17","description":"Ãšhrada faktÃºry Orange","debitAcc":"321","creditAcc":"221","amount":51.8},{"id":242,"date":"2024-10-19","description":"PrevÃ¡dzkovÃ½ materiÃ¡l","debitAcc":"501","creditAcc":"325","amount":63.16},{"id":243,"date":"2024-10-20","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":7.19},{"id":244,"date":"2024-10-24","description":"VÃ½pomoc konateÄ¾a","debitAcc":"249","creditAcc":"221","amount":800.0},{"id":245,"date":"2024-10-30","description":"OstatnÃ© sluÅ¾by, licencie - maXXam","debitAcc":"518","creditAcc":"321","amount":1850.0},{"id":246,"date":"2024-10-31","description":"EkonomickÃ© poradenstvo - REINS INVEST","debitAcc":"311","creditAcc":"602","amount":970.0},{"id":247,"date":"2024-10-31","description":"BankovÃ© poplatky","debitAcc":"568","creditAcc":"221","amount":8.0},{"id":248,"date":"2024-10-31","description":"SociÃ¡lne poistenie-zamestnÃ¡vateÄ¾ 10/24","debitAcc":"524","creditAcc":"336","amount":48.97},{"id":249,"date":"2024-10-31","description":"ZdravotnÃ© poistenie-zamestnÃ¡vateÄ¾ 10/24","debitAcc":"524","creditAcc":"336","amount":21.83},{"id":250,"date":"2024-10-31","description":"HrubÃ© mzdy - dohody 10/24","debitAcc":"521","creditAcc":"331","amount":198.5},{"id":251,"date":"2024-11-02","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":64.04},{"id":252,"date":"2024-11-02","description":"VÃ½pomoc konateÄ¾a","debitAcc":"249","creditAcc":"221","amount":50.0},{"id":253,"date":"2024-11-03","description":"TelefÃ³n, internet - Orange","debitAcc":"518","creditAcc":"321","amount":57.87},{"id":254,"date":"2024-11-05","description":"OstatnÃ© sluÅ¾by, licencie - KROS","debitAcc":"518","creditAcc":"321","amount":9.24},{"id":255,"date":"2024-11-06","description":"Leasing 11/24 - ALD Automotive","debitAcc":"518","creditAcc":"321","amount":448.32},{"id":256,"date":"2024-11-06","description":"Ãšhrada faktÃºry KROS","debitAcc":"321","creditAcc":"221","amount":9.24},{"id":257,"date":"2024-11-06","description":"OstatnÃ© sluÅ¾by","debitAcc":"518","creditAcc":"221","amount":4.5},{"id":258,"date":"2024-11-08","description":"PredplatnÃ© Äasopisov - N Press","debitAcc":"518","creditAcc":"321","amount":7.99},{"id":259,"date":"2024-11-08","description":"Inkaso faktÃºry 20240011 REINS","debitAcc":"221","creditAcc":"311","amount":970.0},{"id":260,"date":"2024-11-10","description":"Ãšhrada faktÃºry N Press","debitAcc":"321","creditAcc":"221","amount":7.99},{"id":261,"date":"2024-11-11","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":83.25},{"id":262,"date":"2024-11-15","description":"VÃ½plata mzdy 10/2024","debitAcc":"331","creditAcc":"211","amount":139.26},{"id":263,"date":"2024-11-15","description":"Ãšhrada faktÃºry ALD Automotive","debitAcc":"321","creditAcc":"221","amount":448.32},{"id":264,"date":"2024-11-15","description":"Ãšhrada dane z prÃ­jmov zÃ¡vislÃ¡ Ä.","debitAcc":"342","creditAcc":"221","amount":32.66},{"id":265,"date":"2024-11-16","description":"Ãšhrada soc. a zdrav. poistenia","debitAcc":"336","creditAcc":"221","amount":29.77},{"id":266,"date":"2024-11-17","description":"Ãšhrada soc. poistenia","debitAcc":"336","creditAcc":"221","amount":67.61},{"id":267,"date":"2024-11-21","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":43.96},{"id":268,"date":"2024-11-22","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":10.5},{"id":269,"date":"2024-11-26","description":"Ãšhrada faktÃºry Orange","debitAcc":"321","creditAcc":"221","amount":57.87},{"id":270,"date":"2024-11-30","description":"OstatnÃ© sluÅ¾by, licencie - maXXam","debitAcc":"518","creditAcc":"321","amount":5900.0},{"id":271,"date":"2024-11-30","description":"EkonomickÃ© poradenstvo - REINS INVEST","debitAcc":"311","creditAcc":"602","amount":900.0},{"id":272,"date":"2024-11-30","description":"TrÅ¾by za poskytnutÃ© sluÅ¾by - maXXam","debitAcc":"311","creditAcc":"602","amount":5400.0},{"id":273,"date":"2024-11-30","description":"BankovÃ© poplatky","debitAcc":"568","creditAcc":"221","amount":8.0},{"id":274,"date":"2024-11-30","description":"ZdravotnÃ© poistenie-zamestnÃ¡vateÄ¾ 11/24","debitAcc":"524","creditAcc":"336","amount":20.35},{"id":275,"date":"2024-11-30","description":"HrubÃ© mzdy - dohody 11/24","debitAcc":"521","creditAcc":"331","amount":185.0},{"id":276,"date":"2024-11-30","description":"SociÃ¡lne poistenie-zamestnÃ¡vateÄ¾ 11/24","debitAcc":"524","creditAcc":"336","amount":45.6},{"id":277,"date":"2024-12-01","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":69.86},{"id":278,"date":"2024-12-03","description":"TelefÃ³n, internet - Orange","debitAcc":"518","creditAcc":"321","amount":54.98},{"id":279,"date":"2024-12-04","description":"Leasing 12/24 - ALD Automotive","debitAcc":"518","creditAcc":"321","amount":448.32},{"id":280,"date":"2024-12-06","description":"Inkaso faktÃºry 20240012 REINS","debitAcc":"221","creditAcc":"311","amount":900.0},{"id":281,"date":"2024-12-06","description":"ParkovnÃ©","debitAcc":"518","creditAcc":"325","amount":25.5},{"id":282,"date":"2024-12-06","description":"PHM","debitAcc":"501","creditAcc":"325","amount":1026.61},{"id":283,"date":"2024-12-08","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":2.5},{"id":284,"date":"2024-12-09","description":"PredplatnÃ© Äasopisov - N Press","debitAcc":"518","creditAcc":"321","amount":7.99},{"id":285,"date":"2024-12-09","description":"VÃ½pomoc konateÄ¾a","debitAcc":"249","creditAcc":"221","amount":500.0},{"id":286,"date":"2024-12-09","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":71.69},{"id":287,"date":"2024-12-10","description":"Ãšhrada faktÃºry N Press","debitAcc":"321","creditAcc":"221","amount":7.99},{"id":288,"date":"2024-12-10","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":21.9},{"id":289,"date":"2024-12-10","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":53.74},{"id":290,"date":"2024-12-10","description":"Ubytovanie","debitAcc":"518","creditAcc":"325","amount":474.34},{"id":291,"date":"2024-12-10","description":"CestovnÃ©","debitAcc":"518","creditAcc":"325","amount":462.42},{"id":292,"date":"2024-12-11","description":"OstatnÃ© sluÅ¾by, licencie - maXXam","debitAcc":"518","creditAcc":"321","amount":1100.0},{"id":293,"date":"2024-12-12","description":"ParkovnÃ©","debitAcc":"518","creditAcc":"211","amount":12.0},{"id":294,"date":"2024-12-12","description":"BankovÃ© poplatky","debitAcc":"568","creditAcc":"221","amount":1.07},{"id":295,"date":"2024-12-12","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":2.85},{"id":296,"date":"2024-12-12","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":28.8},{"id":297,"date":"2024-12-15","description":"VÃ½plata mzdy 11/2024","debitAcc":"331","creditAcc":"211","amount":129.77},{"id":298,"date":"2024-12-15","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":3.0},{"id":299,"date":"2024-12-16","description":"Ãšhrada dane z prÃ­jmov zÃ¡vislÃ¡ Ä.","debitAcc":"342","creditAcc":"221","amount":30.44},{"id":300,"date":"2024-12-16","description":"Ãšhrada soc. a zdrav. poistenia","debitAcc":"336","creditAcc":"221","amount":27.75},{"id":301,"date":"2024-12-16","description":"Ãšhrada soc. poistenia","debitAcc":"336","creditAcc":"221","amount":62.99},{"id":302,"date":"2024-12-17","description":"OstatnÃ© sluÅ¾by","debitAcc":"518","creditAcc":"221","amount":10.5},{"id":303,"date":"2024-12-19","description":"NÃ¡kup plat. kartou","debitAcc":"325","creditAcc":"221","amount":72.64},{"id":304,"date":"2024-12-21","description":"OstatnÃ© sluÅ¾by, licencie - SuperFaktura","debitAcc":"518","creditAcc":"321","amount":14.39},{"id":305,"date":"2024-12-23","description":"Ãšhrada faktÃºry SuperFaktura","debitAcc":"321","creditAcc":"221","amount":14.39},{"id":306,"date":"2024-12-28","description":"Ãšhrada faktÃºry Orange","debitAcc":"321","creditAcc":"221","amount":54.98},{"id":307,"date":"2024-12-30","description":"OstatnÃ© sluÅ¾by, licencie - maXXam","debitAcc":"518","creditAcc":"321","amount":4550.0},{"id":308,"date":"2024-12-30","description":"VrÃ¡tenie vÃ½pomoci konateÄ¾a","debitAcc":"221","creditAcc":"249","amount":5000.0},{"id":309,"date":"2024-12-31","description":"EkonomickÃ© poradenstvo - REINS INVEST","debitAcc":"311","creditAcc":"602","amount":1025.0},{"id":310,"date":"2024-12-31","description":"Vytvorenie reportov - ZVL SLOVAKIA","debitAcc":"311","creditAcc":"602","amount":4200.0},{"id":311,"date":"2024-12-31","description":"TrÅ¾by za poskytnutÃ© sluÅ¾by - maXXam","debitAcc":"311","creditAcc":"602","amount":5000.0},{"id":319,"date":"2024-12-31","description":"DaÅˆ z prÃ­jmov PO","debitAcc":"591","creditAcc":"341","amount":340.0},{"id":320,"date":"2024-12-31","description":"VrÃ¡tenie vÃ½pomoci konateÄ¾a","debitAcc":"221","creditAcc":"249","amount":1050.0},{"id":321,"date":"2024-12-31","description":"Ãšhrada faktÃºry ALD Automotive","debitAcc":"321","creditAcc":"221","amount":448.32},{"id":322,"date":"2024-12-31","description":"Inkaso faktÃºry 20230015","debitAcc":"221","creditAcc":"311","amount":3000.0},{"id":323,"date":"2024-12-31","description":"BankovÃ© poplatky","debitAcc":"568","creditAcc":"221","amount":8.0},{"id":324,"date":"2024-12-31","description":"ZdravotnÃ© poistenie-zamestnÃ¡vateÄ¾ 12/24","debitAcc":"524","creditAcc":"336","amount":10.45},{"id":325,"date":"2024-12-31","description":"HrubÃ© mzdy - dohody 12/24","debitAcc":"521","creditAcc":"331","amount":95.0},{"id":326,"date":"2024-12-31","description":"SociÃ¡lne poistenie-zamestnÃ¡vateÄ¾ 12/24","debitAcc":"524","creditAcc":"336","amount":22.93},{"id":327,"date":"2024-12-31","description":"ZÃ¡vierka","debitAcc":"710","creditAcc":"518","amount":9.5},{"id":328,"date":"2024-12-31","description":"ZÃ¡vierka","debitAcc":"710","creditAcc":"518","amount":200.0},{"id":329,"date":"2024-12-31","description":"ZÃ¡vierka","debitAcc":"710","creditAcc":"521","amount":627.41},{"id":330,"date":"2024-12-31","description":"ZÃ¡vierka","debitAcc":"710","creditAcc":"524","amount":154.17},{"id":331,"date":"2024-12-31","description":"ZÃ¡vierka","debitAcc":"710","creditAcc":"524","amount":69.01},{"id":332,"date":"2024-12-31","description":"ZÃ¡vierka","debitAcc":"710","creditAcc":"568","amount":114.77},{"id":333,"date":"2024-12-31","description":"ZÃ¡vierka","debitAcc":"710","creditAcc":"591","amount":340.0},{"id":334,"date":"2024-12-31","description":"ZÃ¡vierka","debitAcc":"602","creditAcc":"710","amount":17600.0},{"id":335,"date":"2024-12-31","description":"ZÃ¡vierka","debitAcc":"602","creditAcc":"710","amount":11541.0},{"id":336,"date":"2024-12-31","description":"ZÃ¡vierka - ubytovanie","debitAcc":"710","creditAcc":"518","amount":474.34},{"id":337,"date":"2024-12-31","description":"ZÃ¡vierka - predplatnÃ©","debitAcc":"710","creditAcc":"518","amount":89.88},{"id":338,"date":"2024-12-31","description":"ZÃ¡vierka - diaÄ¾niÄnÃ©","debitAcc":"710","creditAcc":"518","amount":71.5},{"id":339,"date":"2024-12-31","description":"ZÃ¡vierka","debitAcc":"710","creditAcc":"501","amount":2405.8},{"id":340,"date":"2024-12-31","description":"ZÃ¡vierka - parkovnÃ©","debitAcc":"710","creditAcc":"518","amount":37.5},{"id":341,"date":"2024-12-31","description":"ZÃ¡vierka - telefÃ³n","debitAcc":"710","creditAcc":"518","amount":625.63},{"id":342,"date":"2024-12-31","description":"ZÃ¡vierka - ostatnÃ© sluÅ¾by","debitAcc":"710","creditAcc":"518","amount":13845.63},{"id":343,"date":"2024-12-31","description":"ZÃ¡vierka - ostatnÃ©","debitAcc":"710","creditAcc":"518","amount":858.87},{"id":344,"date":"2024-12-31","description":"ZÃ¡vierka","debitAcc":"710","creditAcc":"513","amount":838.84},{"id":345,"date":"2024-12-31","description":"ZÃ¡vierka - kancelÃ¡ria","debitAcc":"710","creditAcc":"501","amount":6.57},{"id":346,"date":"2024-12-31","description":"ZÃ¡vierka - PHM","debitAcc":"710","creditAcc":"501","amount":1931.02},{"id":347,"date":"2024-12-31","description":"ZÃ¡vierka - leasing","debitAcc":"710","creditAcc":"518","amount":5378.72},{"id":348,"date":"2024-12-31","description":"ZÃ¡vierka","debitAcc":"710","creditAcc":"702","amount":1061.84},{"id":349,"date":"2024-12-31","description":"ZÃ¡vierka","debitAcc":"341","creditAcc":"702","amount":340.0},{"id":350,"date":"2024-12-31","description":"ZÃ¡vierka","debitAcc":"428","creditAcc":"702","amount":25879.12},{"id":351,"date":"2024-12-31","description":"ZÃ¡vierka","debitAcc":"411","creditAcc":"702","amount":5000.0},{"id":352,"date":"2024-12-31","description":"ZÃ¡vierka","debitAcc":"342","creditAcc":"702","amount":15.63},{"id":353,"date":"2024-12-31","description":"ZÃ¡vierka","debitAcc":"336","creditAcc":"702","amount":14.25},{"id":354,"date":"2024-12-31","description":"ZÃ¡vierka","debitAcc":"336","creditAcc":"702","amount":31.86},{"id":355,"date":"2024-12-31","description":"ZÃ¡vierka","debitAcc":"331","creditAcc":"702","amount":66.64},{"id":356,"date":"2024-12-31","description":"ZÃ¡vierka","debitAcc":"702","creditAcc":"311","amount":12225.0},{"id":357,"date":"2024-12-31","description":"ZÃ¡vierka","debitAcc":"702","creditAcc":"211","amount":11006.32},{"id":358,"date":"2024-12-31","description":"ZÃ¡vierka","debitAcc":"702","creditAcc":"221","amount":9178.02},{"id":9001,"date":"2024-12-31","description":"ZÃ¡poÄet maXXam - OF 20240013 vs DF 20240041/20036","debitAcc":"321","creditAcc":"311","amount":5400.0},{"id":9002,"date":"2024-12-31","description":"ZÃ¡poÄet maXXam - OF 20240016 vs DF 20240047","debitAcc":"321","creditAcc":"311","amount":5000.0},{"id":9003,"date":"2024-12-31","description":"ZÃ¡poÄet maXXam - OF 20240010 vs DF 20240045","debitAcc":"321","creditAcc":"311","amount":3000.0}],"openingBalances":{}};

// â”€â”€ SR Å tandardnÃ© vÃ½kazy â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// Mapovanie ÃºÄtov na Å¡tandardnÃ© riadky sÃºvahy SR
// â”€â”€ SR Å truktÃºra sÃºvahy (Opatrenie MF SR Ä. 4455/2003-92) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// AktÃ­va
const SA_ROWS = [
  // id, label, codes, level  (level 0 = sekcia, 1 = podsekcia, 2 = riadok)
  { id:"A",     label:"A.   POHÄ½ADÃVKY ZA UPÃSANÃ‰ VLASTNÃ‰ IMANIE", codes:[],                           lv:0 },
  { id:"B",     label:"B.   NEOBEÅ½NÃ MAJETOK",                     codes:["021","022","029","051","052"],lv:0 },
  { id:"B.I",   label:"B.I.   DlhodobÃ½ nehmotnÃ½ majetok",          codes:[],                           lv:1 },
  { id:"B.II",  label:"B.II.  DlhodobÃ½ hmotnÃ½ majetok",            codes:["021","022","029"],           lv:2 },
  { id:"B.III", label:"B.III. DlhodobÃ½ finanÄnÃ½ majetok",          codes:[],                           lv:1 },
  { id:"C",     label:"C.   OBEÅ½NÃ MAJETOK",                       codes:["112","211","221","249","261","311","315"],lv:0 },
  { id:"C.I",   label:"C.I.   ZÃ¡soby",                             codes:["112"],                      lv:1 },
  { id:"C.II",  label:"C.II.  DlhodobÃ© pohÄ¾adÃ¡vky",                codes:[],                           lv:1 },
  { id:"C.III", label:"C.III. KrÃ¡tkodobÃ© pohÄ¾adÃ¡vky",              codes:["311","315"],                 lv:2 },
  { id:"C.IV",  label:"C.IV.  FinanÄnÃ© ÃºÄty",                      codes:["211","221","249","261"],     lv:2 },
  { id:"D",     label:"D.   ÄŒASOVÃ‰ ROZLÃÅ ENIE",                    codes:[],                           lv:0 },
];

// PasÃ­va
const SP_ROWS = [
  { id:"A",      label:"A.   VLASTNÃ‰ IMANIE",                         codes:["411","428","431"],        lv:0, addVH:true },
  { id:"A.I",    label:"A.I.   ZÃ¡kladnÃ© imanie",                      codes:["411"],                    lv:1 },
  { id:"A.II",   label:"A.II.  KapitÃ¡lovÃ© fondy",                     codes:[],                         lv:1 },
  { id:"A.III",  label:"A.III. Fondy zo zisku",                       codes:[],                         lv:1 },
  { id:"A.IV",   label:"A.IV.  VH minulÃ½ch rokov",                    codes:["428","431"],              lv:1 },
  { id:"A.V",    label:"A.V.   VH beÅ¾nÃ©ho ÃºÄtovnÃ©ho obdobia",         codes:[],                         lv:1, isVH:true },
  { id:"B",      label:"B.   ZÃVÃ„ZKY",                                codes:["321","325","331","336","341","342"],lv:0 },
  { id:"B.I",    label:"B.I.   Rezervy",                              codes:[],                         lv:1 },
  { id:"B.II",   label:"B.II.  DlhodobÃ© zÃ¡vÃ¤zky",                     codes:[],                         lv:1 },
  { id:"B.III",  label:"B.III. KrÃ¡tkodobÃ© zÃ¡vÃ¤zky",                   codes:["321","325","331","336","341","342"],lv:2 },
  { id:"B.IV",   label:"B.IV.  BankovÃ© Ãºvery a vÃ½pomoci",             codes:[],                         lv:1 },
  { id:"C",      label:"C.   ÄŒASOVÃ‰ ROZLÃÅ ENIE",                      codes:[],                         lv:0 },
];

// VZS riadky (Opatrenie MF SR Ä. 4455/2003-92, prÃ­loha Ä. 2)
const VZS_ROWS = [
  // VÃNOSY Z HOSPODÃRSKEJ ÄŒINNOSTI
  { id:"01", label:"TrÅ¾by z predaja tovaru",                          codes:["604"],         type:"V" },
  { id:"02", label:"NÃ¡klady vynaloÅ¾enÃ© na obstaranie predanÃ©ho tovaru",codes:[],             type:"NK" },
  { id:"03", label:"ObchodnÃ¡ marÅ¾a (r.01â€“r.02)",                      codes:[],             type:"MARZA" },
  { id:"04", label:"TrÅ¾by z predaja vlastnÃ½ch vÃ½robkov a sluÅ¾ieb",    codes:["601","602"],  type:"V" },
  { id:"05", label:"Zmena stavu vnÃºtroorg. zÃ¡sob",                    codes:[],             type:"V" },
  { id:"06", label:"AktivÃ¡cia",                                       codes:[],             type:"V" },
  { id:"07", label:"TrÅ¾by z predaja dlhodobÃ©ho majetku a materiÃ¡lu",  codes:[],             type:"V" },
  { id:"08", label:"OstatnÃ© vÃ½nosy z hospodÃ¡rskej Äinnosti",          codes:["648"],        type:"V" },
  { id:"09", label:"VÃNOSY Z HOSPODÃRSKEJ ÄŒINNOSTI SPOLU",            codes:["601","602","604","648"], type:"SUBTV" },
  // NÃKLADY NA HOSPODÃRSKU ÄŒINNOSÅ¤
  { id:"10", label:"NÃ¡klady na obstaranie predanÃ©ho tovaru",          codes:[],             type:"N" },
  { id:"11", label:"Spotreba materiÃ¡lu, energie a ost. neskladov. dodÃ¡vok", codes:["501","502"], type:"N" },
  { id:"12", label:"SluÅ¾by",                                          codes:["518"],        type:"N" },
  { id:"13", label:"OsobnÃ© nÃ¡klady",                                  codes:["521","524"],  type:"N" },
  { id:"14", label:"Dane a poplatky",                                 codes:["532","538"],  type:"N" },
  { id:"15", label:"Odpisy a OP k dlhodobÃ©mu majetku",               codes:["551"],        type:"N" },
  { id:"16", label:"ZC predanÃ©ho DM a predanÃ©ho materiÃ¡lu",          codes:[],             type:"N" },
  { id:"17", label:"Tvorba OP k pohÄ¾adÃ¡vkam",                        codes:[],             type:"N" },
  { id:"18", label:"OstatnÃ© nÃ¡klady na hospodÃ¡rsku ÄinnosÅ¥",         codes:["513","543"],  type:"N" },
  { id:"19", label:"NÃKLADY NA HOSPODÃRSKU ÄŒINNOSÅ¤ SPOLU",           codes:["501","502","518","521","524","551","513","543","532","538"], type:"SUBTN" },
  { id:"20", label:"* VÃSLEDOK HOSP. Z HOSPODÃRSKEJ ÄŒINNOSTI (r.09â€“r.19)", codes:[], type:"VHH" },
  // FINANÄŒNÃ ÄŒASÅ¤
  { id:"21", label:"TrÅ¾by z predaja cennÃ½ch papierov a podielov",    codes:[],             type:"VF" },
  { id:"22", label:"VÃ½nosy z dlhodobÃ©ho finanÄnÃ©ho majetku",         codes:[],             type:"VF" },
  { id:"27", label:"OstatnÃ© vÃ½nosy z finanÄnej Äinnosti",            codes:[],             type:"VF" },
  { id:"28", label:"VÃNOSY Z FINANÄŒNEJ ÄŒINNOSTI SPOLU",              codes:[],             type:"SUBTVF" },
  { id:"29", label:"NÃ¡klady na finanÄnÃº ÄinnosÅ¥",                    codes:["568"],        type:"NF" },
  { id:"30", label:"NÃKLADY NA FINANÄŒNÃš ÄŒINNOSÅ¤ SPOLU",              codes:["568"],        type:"SUBTNF" },
  { id:"31", label:"* VÃSLEDOK HOSP. Z FINANÄŒNEJ ÄŒINNOSTI (r.28â€“r.30)", codes:[],         type:"VHF" },
  // SÃšHRNNÃ‰
  { id:"32", label:"** VÃSLEDOK HOSP. Z BEÅ½NEJ ÄŒINNOSTI (r.20+r.31)", codes:[],           type:"VHB" },
  { id:"33", label:"Mimoriadne vÃ½nosy",                              codes:[],             type:"VM" },
  { id:"34", label:"Mimoriadne nÃ¡klady",                             codes:[],             type:"NM" },
  { id:"35", label:"* VÃSLEDOK HOSP. Z MIMORIADNEJ ÄŒINNOSTI (r.33â€“r.34)", codes:[],      type:"VHM" },
  { id:"36", label:"DaÅˆ z prÃ­jmov",                                  codes:["591","595"],  type:"DAN" },
  { id:"37", label:"*** VÃSLEDOK HOSP. ZA ÃšÄŒTOVNÃ‰ OBDOBIE (r.32+r.35â€“r.36)", codes:[],  type:"TOTAL" },
];

// â”€â”€ PomocnÃ© funkcie â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getVal(codes, ledger) {
  return codes.reduce((s, c) => {
    const a = ledger[c];
    return s + (a ? balance(a) : 0);
  }, 0);
}

function buildSuvahaRows(template, ledger, vhp) {
  return template.map(row => {
    let val;
    if (row.isVH)      val = vhp;
    else if (row.addVH) val = getVal(row.codes, ledger) + vhp;
    else               val = getVal(row.codes, ledger);
    return { ...row, val };
  });
}

function buildVzsRows(ledger) {
  const v_HC  = getVal(["601","602","604","648"], ledger);
  const n_B   = getVal(["501","502"], ledger);
  const n_S   = getVal(["518"], ledger);
  const n_O   = getVal(["521","524"], ledger);
  const n_Ost = getVal(["513","543","532","538"], ledger);
  const n_Odp = getVal(["551"], ledger);
  const n_HC  = n_B + n_S + n_O + n_Ost + n_Odp;
  const vhHC  = v_HC - n_HC;
  const n_Fin = getVal(["568"], ledger);
  const vhF   = -n_Fin;
  const vhB   = vhHC + vhF;
  const dan   = getVal(["591","595"], ledger);
  const vhTotal = vhB - dan;

  const computed = {
    "09": v_HC,
    "19": n_HC,
    "20": vhHC,
    "28": 0,
    "30": n_Fin,
    "31": vhF,
    "32": vhB,
    "35": 0,
    "36": dan,
    "37": vhTotal,
    "MARZA": 0,
    "SUBTVF": 0,
    "SUBTNF": n_Fin,
    "VHH": vhHC,
    "VHF": vhF,
    "VHB": vhB,
    "VHM": 0,
    "DAN": dan,
    "TOTAL": vhTotal,
  };

  return VZS_ROWS.map(row => {
    let val;
    if (computed[row.id] !== undefined) val = computed[row.id];
    else if (computed[row.type] !== undefined) val = computed[row.type];
    else val = getVal(row.codes || [], ledger);
    return { ...row, val };
  });
}

// â”€â”€ Excel export â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function exportExcel(suvahaA, suvahaP, vzs, year, companyName) {
  if (!window.XLSX) {
    await new Promise((res, rej) => {
      const s = document.createElement("script");
      s.src = "https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js";
      s.onload = res; s.onerror = rej;
      document.head.appendChild(s);
    });
  }
  const X = window.XLSX;
  const wb = X.utils.book_new();

  // Helper: create styled sheet
  function makeSheet(title, company, headers, rows) {
    const data = [
      [title],
      [company],
      [""],
      headers,
      ...rows,
    ];
    return X.utils.aoa_to_sheet(data);
  }

  // SÃºvaha sheet
  const suvahaData = [
    [`SÃšVAHA k 31.12.${year}`, "", ""],
    [companyName, "", ""],
    ["", "", ""],
    ["Riadok", "NÃ¡zov poloÅ¾ky", `${year} (â‚¬)`],
    ["", "AKTÃVA", ""],
    ...suvahaA.map(r => [r.id, r.label, r.val]),
    ["", "", ""],
    ["", "PASÃVA", ""],
    ...suvahaP.map(r => [r.id, r.label, r.val]),
  ];
  const ws1 = X.utils.aoa_to_sheet(suvahaData);
  ws1["!cols"] = [{ wch: 10 }, { wch: 52 }, { wch: 16 }];
  X.utils.book_append_sheet(wb, ws1, "SÃºvaha");

  // VZS sheet
  const vzsData = [
    [`VÃKAZ ZISKOV A STRÃT za rok ${year}`, "", ""],
    [companyName, "", ""],
    ["", "", ""],
    ["Riadok", "NÃ¡zov poloÅ¾ky", `${year} (â‚¬)`],
    ...vzs.map(r => [r.id, r.label, r.val]),
  ];
  const ws2 = X.utils.aoa_to_sheet(vzsData);
  ws2["!cols"] = [{ wch: 8 }, { wch: 58 }, { wch: 16 }];
  X.utils.book_append_sheet(wb, ws2, "VZS");

  X.writeFile(wb, `${companyName.replace(/[^a-zA-Z0-9]/g, "_")}_${year}_vykazy.xlsx`);
}

// â”€â”€ PDF / TlaÄ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function printVykaz(type, year, companyName, suvahaA, suvahaP, vzsComputed) {
  const isSuvaha = type === "suvaha";
  const title = isSuvaha ? ("S\u00favaha k 31.12." + year) : ("V\u00fdkaz ziskov a str\u00e1t za rok " + year);

  const css = `
    body{font-family:Arial,sans-serif;font-size:10.5px;margin:18mm 14mm;color:#000}
    h1{font-size:13px;font-weight:bold;margin:0 0 2px}
    h2{font-size:10px;font-weight:normal;color:#444;margin:0 0 12px}
    table{width:100%;border-collapse:collapse;margin-top:6px}
    thead tr th{background:#e8ecf0;border:1px solid #bbb;padding:4px 7px;font-size:9.5px;text-align:left}
    td{border:1px solid #d0d0d0;padding:3px 7px;font-size:10px}
    .sec td{background:#dce3ea;font-weight:bold;font-size:10.5px}
    .sub td{background:#f0f3f6;font-weight:600}
    .tot td{background:#c8d8f0;font-weight:bold;font-size:11px;border-top:2px solid #555}
    .vzs-subtv td{background:#dce8ff;font-weight:bold}
    .vzs-subtn td{background:#ffe4e4;font-weight:bold}
    .vzs-res td{background:#d4edda;font-weight:bold}
    .vzs-total td{background:#c3e6cb;font-weight:bold;font-size:11px;border-top:2px solid #333}
    .num{text-align:right;font-family:"Courier New",monospace;white-space:nowrap}
    .indent1{padding-left:18px!important}
    .indent2{padding-left:34px!important}
    @page{margin:15mm}
    @media print{body{margin:0}}
  `;

  function fmtNum(n) {
    if (n === undefined || n === null || n === "") return "";
    return new Intl.NumberFormat("sk-SK", { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(n);
  }

  let body = "";

  if (isSuvaha) {
    const renderSide = (rows, sideTitle) => {
      let html = `<tr><td colspan="3" style="background:#334155;color:#fff;font-weight:bold;padding:5px 8px;border:1px solid #334155">${sideTitle}</td></tr>`;
      rows.forEach(r => {
        const cls = r.lv === 0 ? "sec" : r.lv === 1 ? "sub" : "";
        const ind = r.lv === 0 ? "" : r.lv === 1 ? "indent1" : "indent2";
        html += `<tr class="${cls}"><td style="width:60px">${r.id}</td><td class="${ind}">${r.label}</td><td class="num" style="width:120px">${r.val !== 0 ? fmtNum(r.val) : (r.lv > 0 ? "â€”" : fmtNum(0))}</td></tr>`;
      });
      return html;
    };

    const totalA = suvahaA.find(r => r.id === "C") ? suvahaA.reduce((s, r) => r.lv === 0 ? s + r.val : s, 0) : 0;
    const totalP = suvahaP.find(r => r.id === "A") ? suvahaP.reduce((s, r) => r.lv === 0 ? s + r.val : s, 0) : 0;

    body = `
      <table>
        <thead><tr><th style="width:60px">Riadok</th><th>PoloÅ¾ka</th><th style="width:120px;text-align:right">Suma (â‚¬)</th></tr></thead>
        <tbody>
          ${renderSide(suvahaA, "AKTÃVA")}
          <tr class="tot"><td colspan="2">AKTÃVA SPOLU</td><td class="num">${fmtNum(totalA)}</td></tr>
          ${renderSide(suvahaP, "PASÃVA")}
          <tr class="tot"><td colspan="2">PASÃVA SPOLU</td><td class="num">${fmtNum(totalP)}</td></tr>
        </tbody>
      </table>`;
  } else {
    const rowClass = (type) => {
      if (type === "TOTAL") return "vzs-total";
      if (type === "VHH" || type === "VHF" || type === "VHB") return "vzs-res";
      if (type === "SUBTV" || type === "SUBTVF") return "vzs-subtv";
      if (type === "SUBTN" || type === "SUBTNF") return "vzs-subtn";
      return "";
    };
    const isSection = (type) => ["SUBTV","SUBTN","VHH","VHF","VHB","SUBTVF","SUBTNF","VHM","TOTAL"].includes(type);

    body = `
      <table>
        <thead><tr><th style="width:48px">Riad.</th><th>PoloÅ¾ka</th><th style="width:120px;text-align:right">Suma (â‚¬)</th></tr></thead>
        <tbody>
          ${vzsComputed.map(r => {
            const cls = rowClass(r.type);
            const ind = isSection(r.type) ? "" : "indent1";
            const showZero = isSection(r.type);
            return `<tr class="${cls}"><td>${isSection(r.type) ? "" : r.id}</td><td class="${ind}">${r.label}</td><td class="num">${r.val !== 0 || showZero ? fmtNum(Math.abs(r.val)) : "â€”"}</td></tr>`;
          }).join("")}
        </tbody>
      </table>`;
  }

  const w = window.open("", "_blank");
  if (!w) return;
  w.document.write(`<!DOCTYPE html><html><head><meta charset="utf-8"><title>${title}</title><style>${css}</style></head><body>
    <h1>${title}</h1>
    <h2>${companyName}</h2>
    ${body}
  </body></html>`);
  w.document.close();
  w.focus();
  setTimeout(() => w.print(), 500);
}



// â”€â”€ KategÃ³rie dokladov â†’ automatickÃ© ÃºÄtovanie â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const CATEGORIES = [
  // â”€â”€ VydanÃ© faktÃºry â”€â”€
  { group: "VydanÃ© faktÃºry",  id: "vf_sluzby",    label: "VydanÃ¡ faktÃºra â€” sluÅ¾by",             debit: "311", credit: "602", descPrefix: "Fakt. vydanÃ¡ â€” sluÅ¾by" },
  { group: "VydanÃ© faktÃºry",  id: "vf_tovar",     label: "VydanÃ¡ faktÃºra â€” tovar",              debit: "311", credit: "604", descPrefix: "Fakt. vydanÃ¡ â€” tovar" },
  { group: "VydanÃ© faktÃºry",  id: "vf_vyrobky",   label: "VydanÃ¡ faktÃºra â€” vÃ½robky",            debit: "311", credit: "601", descPrefix: "Fakt. vydanÃ¡ â€” vÃ½robky" },
  // â”€â”€ PrijatÃ© faktÃºry â”€â”€
  { group: "PrijatÃ© faktÃºry", id: "pf_sluzby",    label: "PrijatÃ¡ faktÃºra â€” sluÅ¾by",            debit: "518", credit: "321", descPrefix: "Fakt. prijatÃ¡ â€” sluÅ¾by" },
  { group: "PrijatÃ© faktÃºry", id: "pf_material",  label: "PrijatÃ¡ faktÃºra â€” materiÃ¡l",          debit: "112", credit: "321", descPrefix: "Fakt. prijatÃ¡ â€” materiÃ¡l" },
  { group: "PrijatÃ© faktÃºry", id: "pf_energia",   label: "PrijatÃ¡ faktÃºra â€” energia",           debit: "502", credit: "321", descPrefix: "Fakt. prijatÃ¡ â€” energia" },
  { group: "PrijatÃ© faktÃºry", id: "pf_opravy",    label: "PrijatÃ¡ faktÃºra â€” opravy a ÃºdrÅ¾ba",   debit: "511", credit: "321", descPrefix: "Fakt. prijatÃ¡ â€” opravy" },
  { group: "PrijatÃ© faktÃºry", id: "pf_cestovne",  label: "PrijatÃ¡ faktÃºra â€” cestovnÃ©",          debit: "512", credit: "321", descPrefix: "Fakt. prijatÃ¡ â€” cestovnÃ©" },
  { group: "PrijatÃ© faktÃºry", id: "pf_repr",      label: "PrijatÃ¡ faktÃºra â€” reprezentÃ¡cia",     debit: "513", credit: "321", descPrefix: "Fakt. prijatÃ¡ â€” reprezentÃ¡cia" },
  { group: "PrijatÃ© faktÃºry", id: "pf_najem",     label: "PrijatÃ¡ faktÃºra â€” nÃ¡jom",             debit: "518", credit: "321", descPrefix: "Fakt. prijatÃ¡ â€” nÃ¡jom" },
  { group: "PrijatÃ© faktÃºry", id: "pf_ost",       label: "PrijatÃ¡ faktÃºra â€” ostatnÃ© nÃ¡klady",   debit: "548", credit: "321", descPrefix: "Fakt. prijatÃ¡ â€” ostatnÃ©" },
  // â”€â”€ BankovÃ© operÃ¡cie â”€â”€
  { group: "Banka",           id: "bk_inkaso",    label: "PrÃ­jem od odberateÄ¾a (banka)",        debit: "221", credit: "311", descPrefix: "Ãšhrada faktÃºry â€” prÃ­jem" },
  { group: "Banka",           id: "bk_uhrada",    label: "Ãšhrada dodÃ¡vateÄ¾ovi (banka)",         debit: "321", credit: "221", descPrefix: "Ãšhrada faktÃºry â€” vÃ½daj" },
  { group: "Banka",           id: "bk_poplatky",  label: "BankovÃ© poplatky",                    debit: "568", credit: "221", descPrefix: "BankovÃ© poplatky" },
  { group: "Banka",           id: "bk_urok_v",    label: "Ãšroky prijatÃ© z banky",               debit: "221", credit: "662", descPrefix: "Ãšroky prijatÃ©" },
  { group: "Banka",           id: "bk_urok_n",    label: "Ãšroky zaplatenÃ© (bankovÃ½ Ãºver)",      debit: "562", credit: "221", descPrefix: "Ãšroky zaplatenÃ©" },
  { group: "Banka",           id: "bk_kurz_zisk", label: "KurzovÃ½ zisk",                        debit: "221", credit: "663", descPrefix: "KurzovÃ½ zisk" },
  { group: "Banka",           id: "bk_kurz_str",  label: "KurzovÃ¡ strata",                      debit: "563", credit: "221", descPrefix: "KurzovÃ¡ strata" },
  // â”€â”€ PokladÅˆa â”€â”€
  { group: "PokladÅˆa",        id: "pk_prijem",    label: "PrÃ­jem hotovosti (trÅ¾ba)",            debit: "211", credit: "602", descPrefix: "PokladniÄnÃ½ prÃ­jem â€” trÅ¾ba" },
  { group: "PokladÅˆa",        id: "pk_vydaj_sl",  label: "VÃ½daj â€” nÃ¡kup sluÅ¾by",                debit: "518", credit: "211", descPrefix: "PokladniÄnÃ½ vÃ½daj â€” sluÅ¾by" },
  { group: "PokladÅˆa",        id: "pk_vydaj_mat", label: "VÃ½daj â€” nÃ¡kup materiÃ¡lu",             debit: "501", credit: "211", descPrefix: "PokladniÄnÃ½ vÃ½daj â€” materiÃ¡l" },
  { group: "PokladÅˆa",        id: "pk_cestovne",  label: "VÃ½daj â€” cestovnÃ© nÃ¡hrady",            debit: "512", credit: "211", descPrefix: "CestovnÃ© nÃ¡hrady" },
  { group: "PokladÅˆa",        id: "pk_repr",      label: "VÃ½daj â€” reprezentÃ¡cia",               debit: "513", credit: "211", descPrefix: "ReprezentÃ¡cia" },
  { group: "PokladÅˆa",        id: "pk_ost",       label: "VÃ½daj â€” ostatnÃ©",                     debit: "548", credit: "211", descPrefix: "PokladniÄnÃ½ vÃ½daj â€” ostatnÃ©" },
  { group: "PokladÅˆa",        id: "pk_vklad",     label: "Vklad hotovosti na ÃºÄet",             debit: "221", credit: "261", descPrefix: "Prevod pokladÅˆa â†’ banka" },
  { group: "PokladÅˆa",        id: "pk_vyber",     label: "VÃ½ber hotovosti z banky",             debit: "261", credit: "221", descPrefix: "VÃ½ber z banky do pokladne" },
  // â”€â”€ Mzdy â”€â”€
  { group: "Mzdy",            id: "mzdy_naklady", label: "MzdovÃ© nÃ¡klady",                      debit: "521", credit: "331", descPrefix: "Mzdy â€” nÃ¡klady" },
  { group: "Mzdy",            id: "mzdy_odvody",  label: "Odvody SP a ZP (zamestnÃ¡vateÄ¾)",      debit: "524", credit: "336", descPrefix: "Odvody SP/ZP â€” zamestnÃ¡vateÄ¾" },
  { group: "Mzdy",            id: "mzdy_vyplata", label: "VÃ½plata mzdy",                        debit: "331", credit: "221", descPrefix: "VÃ½plata mzdy" },
  { group: "Mzdy",            id: "mzdy_uh_odv",  label: "Ãšhrada odvodov SP a ZP",              debit: "336", credit: "221", descPrefix: "Ãšhrada odvodov SP/ZP" },
  { group: "Mzdy",            id: "mzdy_uh_dan",  label: "Ãšhrada preddavku na daÅˆ zo mzdy",    debit: "342", credit: "221", descPrefix: "Ãšhrada preddavku na daÅˆ" },
  // â”€â”€ Dane â”€â”€
  { group: "Dane",            id: "dan_prijem",   label: "DaÅˆ z prÃ­jmov â€” splatnÃ¡",             debit: "591", credit: "341", descPrefix: "DaÅˆ z prÃ­jmov â€” predpis" },
  { group: "Dane",            id: "dan_uh",        label: "Ãšhrada dane z prÃ­jmov",               debit: "341", credit: "221", descPrefix: "Ãšhrada dane z prÃ­jmov" },
  { group: "Dane",            id: "dan_dph_v",     label: "DPH na vÃ½stupe (z predaja)",          debit: "604", credit: "343", descPrefix: "DPH na vÃ½stupe" },
  { group: "Dane",            id: "dan_dph_n",     label: "DPH na vstupe (z nÃ¡kupu)",            debit: "343", credit: "321", descPrefix: "DPH na vstupe" },
  { group: "Dane",            id: "dan_dph_uh",    label: "Ãšhrada DPH daÅˆovÃ©mu Ãºradu",          debit: "343", credit: "221", descPrefix: "Ãšhrada DPH" },
  // â”€â”€ DlhodobÃ½ majetok â”€â”€
  { group: "Majetok",         id: "maj_nakup",    label: "NÃ¡kup DHM (faktÃºra)",                 debit: "042", credit: "321", descPrefix: "NÃ¡kup DHM â€” faktÃºra" },
  { group: "Majetok",         id: "maj_zarad",    label: "Zaradenie DHM do evidencie",          debit: "022", credit: "042", descPrefix: "Zaradenie do evidencie" },
  { group: "Majetok",         id: "maj_odpis",    label: "Odpisy DHM/DNM",                      debit: "551", credit: "082", descPrefix: "Odpisy DHM" },
  { group: "Majetok",         id: "maj_prodaj",   label: "Predaj DHM â€” trÅ¾ba",                  debit: "311", credit: "641", descPrefix: "Predaj DHM â€” trÅ¾ba" },
  // â”€â”€ OstatnÃ© â”€â”€
  { group: "OstatnÃ©",         id: "ost_rezerva",  label: "Tvorba rezervy",                      debit: "548", credit: "323", descPrefix: "Tvorba rezervy" },
  { group: "OstatnÃ©",         id: "ost_manko",    label: "Manko / Å¡koda",                       debit: "549", credit: "112", descPrefix: "Manko/Å¡koda" },
  { group: "OstatnÃ©",         id: "ost_dar",      label: "Dar (nÃ¡klad)",                        debit: "543", credit: "321", descPrefix: "Dar" },
  { group: "OstatnÃ©",         id: "ost_pokuta",   label: "Pokuta / penÃ¡le (nÃ¡klad)",            debit: "545", credit: "321", descPrefix: "Pokuta/penÃ¡le" },
  { group: "OstatnÃ©",         id: "manual",       label: "âœ RuÄnÃ© zadanie ÃºÄtov",              debit: "",    credit: "",    descPrefix: "" },
  // â”€â”€ Dividendy â”€â”€
  { group: "Dividendy",       id: "div_predpis",  label: "Predpis dividendy spoloÄnÃ­kovi",      debit: "431", credit: "364", descPrefix: "Predpis dividendy" },
  { group: "Dividendy",       id: "div_uhrada",   label: "Ãšhrada dividendy (banka)",            debit: "364", credit: "221", descPrefix: "Ãšhrada dividendy" },
  { group: "Dividendy",       id: "div_zrazka",   label: "ZrÃ¡Å¾kovÃ¡ daÅˆ z dividendy",            debit: "364", credit: "342", descPrefix: "ZrÃ¡Å¾kovÃ¡ daÅˆ z dividendy" },
  { group: "Dividendy",       id: "div_uh_dan",   label: "Ãšhrada zrÃ¡Å¾kovej dane (DÃš)",         debit: "342", credit: "221", descPrefix: "Ãšhrada zrÃ¡Å¾kovej dane" },
  // â”€â”€ NÃ¡jom â”€â”€
  { group: "NÃ¡jom",           id: "naj_vf",       label: "VydanÃ¡ faktÃºra za nÃ¡jom",             debit: "311", credit: "602", descPrefix: "Fakt. vydanÃ¡ â€” nÃ¡jom" },
  { group: "NÃ¡jom",           id: "naj_prijem_b", label: "PrÃ­jem nÃ¡jmu na bankovÃ½ ÃºÄet",        debit: "221", credit: "602", descPrefix: "PrÃ­jem nÃ¡jmu â€” banka" },
  { group: "NÃ¡jom",           id: "naj_prijem_p", label: "PrÃ­jem nÃ¡jmu v hotovosti",            debit: "211", credit: "602", descPrefix: "PrÃ­jem nÃ¡jmu â€” pokladÅˆa" },
  { group: "NÃ¡jom",           id: "naj_pf",       label: "PrijatÃ¡ faktÃºra za nÃ¡jom (nÃ¡jomca)",  debit: "518", credit: "321", descPrefix: "Fakt. prijatÃ¡ â€” nÃ¡jom" },
  { group: "NÃ¡jom",           id: "naj_uh",       label: "Ãšhrada nÃ¡jmu (nÃ¡jomca)",              debit: "321", credit: "221", descPrefix: "Ãšhrada nÃ¡jmu" },
];

const CAT_BY_ID = Object.fromEntries(CATEGORIES.map(c => [c.id, c]));


function App() {
  const [data, setData] = useState({});
  const [year, setYear] = useState(String(new Date().getFullYear()));
  const [tab, setTab] = useState("dennik");
  const [modal, setModal] = useState(null);
  const [loaded, setLoaded] = useState(false);

  const [form, setForm] = useState({ date: today(), description: "", debitAcc: "", creditAcc: "", amount: "" });
  const [importText, setImportText] = useState("");
  const [newYearVal, setNewYearVal] = useState("");
  const [openingAcc, setOpeningAcc] = useState({ code: "", debit: "", credit: "" });
  const [filterAcc, setFilterAcc] = useState("");

  useEffect(() => {
    (async () => {
      // SEED_DATA is in import format {year, entries, openingBalances}
      // App stores data as { "2024": {entries, openingBalances}, ... }
      const seedFormatted = {
        [SEED_DATA.year]: {
          entries: SEED_DATA.entries ?? [],
          openingBalances: SEED_DATA.openingBalances ?? {}
        }
      };
      let loaded = false;
      try {
        const _raw = localStorage.getItem(STORAGE_KEY); const r = _raw ? { value: _raw } : null;
        if (r?.value) {
          const parsed = JSON.parse(r.value);
          // Check it's in the correct format (has year keys with entries arrays)
          const hasData = Object.values(parsed).some(v => v?.entries?.length > 0);
          if (hasData) {
            setData(parsed);
            loaded = true;
          }
        }
      } catch (_) {}
      if (!loaded) {
        setData(seedFormatted);
        try { localStorage.setItem(STORAGE_KEY, JSON.stringify(seedFormatted)); } catch (_) {}
      }
      setLoaded(true);
    })();
  }, []);

  // Auto-select most recent year when data loads
  useEffect(() => {
    const years = Object.keys(data).sort();
    if (years.length > 0) {
      setYear(prev => years.includes(prev) ? prev : years[years.length - 1]);
    }
  }, [data]);

    const save = useCallback(async (d) => {
    try { localStorage.setItem(STORAGE_KEY, JSON.stringify(d)); } catch (_) {}
  }, []);

  const setDataAndSave = (fn) => {
    setData(prev => {
      const next = typeof fn === "function" ? fn(prev) : fn;
      save(next);
      return next;
    });
  };

  if (!loaded) return (
    <div style={{ background: "#0b0f1a", height: "100vh", display: "flex", alignItems: "center", justifyContent: "center", color: "#6b7280", fontFamily: "'IBM Plex Mono', monospace" }}>
      NaÄÃ­tavam dÃ¡taâ€¦
    </div>
  );

  const yearData = data[year] ?? emptyYear();
  const ledger = calcLedger(yearData.entries, yearData.openingBalances);
  const years = Object.keys(data).sort();

  const addEntry = () => {
    if (!form.date || !form.debitAcc || !form.creditAcc || !form.amount) return;
    const base = {
      date: form.date,
      description: form.description,
      debitAcc: form.debitAcc,
      creditAcc: form.creditAcc,
      amount: parseFloat(form.amount),
      categoryId: form.categoryId || "",
    };
    if (form.editId) {
      setDataAndSave(prev => ({
        ...prev,
        [year]: { ...(prev[year] ?? emptyYear()), entries: (prev[year]?.entries ?? []).map(e =>
          e.id === form.editId ? { id: e.id, ...base } : e
        )}
      }));
    } else {
      setDataAndSave(prev => ({
        ...prev,
        [year]: { ...(prev[year] ?? emptyYear()), entries: [...(prev[year]?.entries ?? []), { id: Date.now(), ...base }] }
      }));
    }
    setForm({ date: today(), description: "", debitAcc: "", creditAcc: "", amount: "" });
    setModal(null);
  };

  const deleteEntry = (id) => {
    setDataAndSave(prev => ({
      ...prev,
      [year]: { ...(prev[year] ?? emptyYear()), entries: (prev[year]?.entries ?? []).filter(e => e.id !== id) }
    }));
  };

  const editEntry = (e) => {
    setForm({ date: e.date, description: e.description, debitAcc: e.debitAcc, creditAcc: e.creditAcc, amount: String(e.amount), editId: e.id, categoryId: e.categoryId || "manual" });
    setModal("entry");
  };

  const createYear = () => {
    if (!newYearVal || data[newYearVal]) return;
    setDataAndSave(prev => ({ ...prev, [newYearVal]: emptyYear() }));
    setYear(newYearVal);
    setNewYearVal("");
    setModal(null);
  };

  const saveOpening = () => {
    if (!openingAcc.code) return;
    setDataAndSave(prev => ({
      ...prev,
      [year]: {
        ...(prev[year] ?? emptyYear()),
        openingBalances: {
          ...(prev[year]?.openingBalances ?? {}),
          [openingAcc.code]: { debit: parseFloat(openingAcc.debit) || 0, credit: parseFloat(openingAcc.credit) || 0 }
        }
      }
    }));
    setOpeningAcc({ code: "", debit: "", credit: "" });
    setModal(null);
  };

  const doImport = () => {
    try {
      const imp = JSON.parse(importText);
      const y = imp.year ?? newYearVal;
      if (!y) return alert("JSON musÃ­ obsahovaÅ¥ pole 'year'.");
      setDataAndSave(prev => ({ ...prev, [y]: { entries: imp.entries ?? [], openingBalances: imp.openingBalances ?? {} } }));
      setYear(y);
      setImportText("");
      setModal(null);
    } catch { alert("NeplatnÃ½ JSON formÃ¡t."); }
  };

  const handleAiImport = (targetYear, entries) => {
    setDataAndSave(prev => {
      const existing = prev[targetYear] ?? emptyYear();
      return { ...prev, [targetYear]: { ...existing, entries: [...existing.entries, ...entries] } };
    });
    setYear(targetYear);
    setModal(null);
  };

  const totalDebit = yearData.entries.reduce((s, e) => s + e.amount, 0);
  // Exclude zÃ¡vierka closing entries for all reports â€” they zero out accounts
  const prevadzkovÃ©Entries = yearData.entries.filter(e => !e.description?.startsWith("ZÃ¡vierka"));
  const ledgerBez = calcLedger(prevadzkovÃ©Entries, yearData.openingBalances);
  const aktiva = Object.values(ledgerBez).filter(a => a.type === "A");
  const pasiva = Object.values(ledgerBez).filter(a => a.type === "P");
  const naklady = Object.values(ledgerBez).filter(a => a.type === "N");
  const vynosy = Object.values(ledgerBez).filter(a => a.type === "V");
  const sumBal = (arr) => arr.reduce((s, a) => s + balance(a), 0);
  const vhp = sumBal(vynosy) - sumBal(naklady);
  const filteredEntries = filterAcc
    ? yearData.entries.filter(e => e.debitAcc === filterAcc || e.creditAcc === filterAcc)
    : yearData.entries;

  const inp = {
    background: "#1f2937", border: "1px solid #374151", borderRadius: 8,
    color: "#f9fafb", padding: "8px 12px", fontSize: 14, width: "100%",
    fontFamily: "'IBM Plex Mono', monospace", outline: "none"
  };
  const btn = (color = "#10b981") => ({
    background: color, border: "none", borderRadius: 8, color: "#fff",
    padding: "8px 18px", cursor: "pointer", fontFamily: "'IBM Plex Mono', monospace",
    fontSize: 13, fontWeight: 600, letterSpacing: 0.5, transition: "opacity .15s"
  });
  const th = { color: "#9ca3af", fontSize: 11, letterSpacing: 1, textTransform: "uppercase", padding: "8px 12px", borderBottom: "1px solid #1f2937", textAlign: "left" };
  const td = { padding: "9px 12px", fontSize: 13, color: "#e5e7eb", borderBottom: "1px solid #111827" };

  const TABS = [
    { id: "dennik", label: "ğŸ“‹ DennÃ­k" },
    { id: "kniha", label: "ğŸ“š HlavnÃ¡ kniha" },
    { id: "suvaha", label: "âš–ï¸ SÃºvaha" },
    { id: "vysledovka", label: "ğŸ“Š VÃ½sledovka" },
    { id: "zahajovacia", label: "ğŸ”¢ OtvÃ¡racie zostatky" },
  ];

  return (
    <div style={{ minHeight: "100vh", background: "#0b0f1a", fontFamily: "'IBM Plex Mono', monospace", color: "#f9fafb" }}>
      <style>{`
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=IBM+Plex+Mono:wght@400;600&display=swap');
        * { box-sizing: border-box; margin: 0; padding: 0; }
        select option { background: #1f2937; }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #0d1117; }
        ::-webkit-scrollbar-thumb { background: #374151; border-radius: 3px; }
        tbody tr:hover td { background: #161d2e !important; }
        button:hover { opacity: .82; }
        input[type=checkbox] { accent-color: #10b981; }
      `}</style>

      {/* Header */}
      <div style={{ borderBottom: "1px solid #1f2937", padding: "0 24px", display: "flex", alignItems: "center", justifyContent: "space-between", minHeight: 60, background: "#0d1117", flexWrap: "wrap", gap: 8, paddingTop: 8, paddingBottom: 8 }}>
        <div style={{ display: "flex", alignItems: "center", gap: 12, flexWrap: "wrap" }}>
          <span style={{ fontFamily: "'Playfair Display',serif", fontSize: 20, color: "#f9fafb", letterSpacing: 0.5 }}>âŠ PodvojnÃ© ÃºÄtovnÃ­ctvo</span>
          <span style={{ color: "#374151" }}>|</span>
          <select value={year} onChange={e => setYear(e.target.value)} style={{ ...inp, width: "auto", padding: "5px 10px", fontSize: 14 }}>
            {years.length === 0 && <option value={year}>{year}</option>}
            {years.map(y => <option key={y} value={y}>{y}</option>)}
          </select>
          <button onClick={() => setModal("newYear")} style={{ ...btn("#6366f1"), padding: "5px 12px", fontSize: 12 }}>+ Rok</button>
        </div>
        <div style={{ display: "flex", gap: 6, flexWrap: "wrap" }}>
          <button onClick={() => setModal("importPdf")} style={{ ...btn("#f59e0b"), fontSize: 12, padding: "6px 14px" }}>ğŸ“„ PDF import</button>
          <button onClick={() => setModal("importXml")} style={{ ...btn("#6366f1"), fontSize: 12, padding: "6px 14px" }}>ğŸ¦ XML vÃ½pis</button>
          <button onClick={() => setModal("importJson")} style={{ ...btn("#374151"), fontSize: 12, padding: "6px 14px" }}>â¬† JSON</button>
          <button onClick={() => {
            const exp = JSON.stringify({ year, ...yearData }, null, 2);
            const a = document.createElement("a"); a.href = "data:text/json," + encodeURIComponent(exp);
            a.download = `uctovnictvo-${year}.json`; a.click();
          }} style={{ ...btn("#374151"), fontSize: 12, padding: "6px 14px" }}>â¬‡ Export</button>
          <button onClick={() => setModal("ocr")} style={{ ...btn("#7c3aed"), fontSize: 12, padding: "6px 14px" }}>ğŸ“· OCR doklad</button>
          <button onClick={() => setModal("entry")} style={{ ...btn("#10b981"), fontSize: 12, padding: "6px 14px" }}>+ ZÃ¡pis</button>
        </div>
      </div>

      {/* Summary bar */}
      <div style={{ display: "flex", gap: 1, background: "#1f2937" }}>
        {[
          { label: "ZÃ¡znamy", val: yearData.entries.length, unit: "ks" },
          { label: "Obrat MD", val: fmt(totalDebit), unit: "â‚¬" },
          { label: "AktÃ­va", val: fmt(sumBal(aktiva)), unit: "â‚¬" },
          { label: "PasÃ­va", val: fmt(sumBal(pasiva)), unit: "â‚¬" },
          { label: "VÃ½sledok hosp.", val: fmt(vhp), unit: "â‚¬", accent: vhp >= 0 ? "#4ade80" : "#f87171" },
        ].map(s => (
          <div key={s.label} style={{ flex: 1, padding: "10px 12px", background: "#0d1117", textAlign: "center" }}>
            <div style={{ fontSize: 10, color: "#6b7280", letterSpacing: 1, textTransform: "uppercase" }}>{s.label}</div>
            <div style={{ fontSize: 16, fontWeight: 700, color: s.accent ?? "#f9fafb", marginTop: 3 }}>{s.val} {s.unit}</div>
          </div>
        ))}
      </div>

      {/* Tabs */}
      <div style={{ display: "flex", padding: "0 20px", borderBottom: "1px solid #1f2937", background: "#0d1117", overflowX: "auto" }}>
        {TABS.map(t => (
          <button key={t.id} onClick={() => setTab(t.id)} style={{
            background: "transparent", border: "none",
            borderBottom: tab === t.id ? "2px solid #10b981" : "2px solid transparent",
            color: tab === t.id ? "#f9fafb" : "#6b7280",
            padding: "13px 18px", cursor: "pointer", fontSize: 13,
            fontFamily: "'IBM Plex Mono', monospace", transition: "color .15s", whiteSpace: "nowrap"
          }}>{t.label}</button>
        ))}
      </div>

      {/* Content */}
      <div style={{ padding: 24 }}>

        {/* DENNIK */}
        {tab === "dennik" && (
          <div>
            <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 16, flexWrap: "wrap", gap: 10 }}>
              <span style={{ fontFamily: "'Playfair Display',serif", fontSize: 18 }}>ÃšÄtovnÃ½ dennÃ­k â€” {year}</span>
              <select value={filterAcc} onChange={e => setFilterAcc(e.target.value)} style={{ ...inp, width: 280 }}>
                <option value="">VÅ¡etky ÃºÄty</option>
                {ACCOUNT_CHART.map(a => <option key={a.code} value={a.code}>{a.code} â€“ {a.name}</option>)}
              </select>
            </div>
            <div style={{ borderRadius: 12, overflow: "hidden", border: "1px solid #1f2937" }}>
              <table style={{ width: "100%", borderCollapse: "collapse" }}>
                <thead style={{ background: "#0d1117" }}>
                  <tr>{["DÃ¡tum","KategÃ³ria / Popis","MD ÃºÄet","D ÃºÄet","Suma (â‚¬)",""].map(h => <th key={h} style={th}>{h}</th>)}</tr>
                </thead>
                <tbody>
                  {filteredEntries.length === 0 && (
                    <tr><td colSpan={6} style={{ ...td, textAlign: "center", color: "#4b5563", padding: "50px 20px" }}>
                      <div style={{ fontSize: 32, marginBottom: 12 }}>ğŸ“­</div>
                      <div>Å½iadne zÃ¡znamy. PouÅ¾ite <strong style={{ color: "#f59e0b" }}>ğŸ“„ PDF import</strong>, <strong style={{ color: "#6366f1" }}>ğŸ¦ XML vÃ½pis</strong> alebo <strong style={{ color: "#10b981" }}>+ ZÃ¡pis</strong>.</div>
                    </td></tr>
                  )}
                  {[...filteredEntries].reverse().map(e => (
                    <tr key={e.id}>
                      <td style={{ ...td, color: "#9ca3af" }}>{e.date}</td>
                      <td style={{ ...td, maxWidth: 300 }}>
                        {e.categoryId && CAT_BY_ID[e.categoryId] && e.categoryId !== "manual" && (
                          <div style={{ fontSize: 10, color: "#6366f1", fontWeight: 600, marginBottom: 2, letterSpacing: 0.5 }}>
                            {CAT_BY_ID[e.categoryId].group} â€º {CAT_BY_ID[e.categoryId].label}
                          </div>
                        )}
                        <div style={{ overflow: "hidden", textOverflow: "ellipsis", whiteSpace: "nowrap", fontSize: 12 }}>{e.description}</div>
                      </td>
                      <td style={{ ...td, color: "#4ade80" }}>{e.debitAcc} <span style={{ color: "#374151" }}>({ledger[e.debitAcc]?.name ?? "?"})</span></td>
                      <td style={{ ...td, color: "#f472b6" }}>{e.creditAcc} <span style={{ color: "#374151" }}>({ledger[e.creditAcc]?.name ?? "?"})</span></td>
                      <td style={{ ...td, textAlign: "right", fontWeight: 700, color: "#10b981", whiteSpace: "nowrap" }}>{fmt(e.amount)}</td>
                      <td style={{ ...td, whiteSpace: "nowrap" }}>
                        <button onClick={() => editEntry(e)} style={{ background: "none", border: "none", color: "#6366f1", cursor: "pointer", fontSize: 15, lineHeight: 1, padding: "0 6px" }} title="UpraviÅ¥">âœï¸</button>
                        <button onClick={() => deleteEntry(e.id)} style={{ background: "none", border: "none", color: "#ef4444", cursor: "pointer", fontSize: 18, lineHeight: 1, padding: "0 4px" }} title="VymazaÅ¥">Ã—</button>
                      </td>
                    </tr>
                  ))}
                </tbody>
                {filteredEntries.length > 0 && (
                  <tfoot style={{ background: "#0d1117" }}>
                    <tr>
                      <td colSpan={4} style={{ ...td, color: "#6b7280", textAlign: "right" }}>CELKOM</td>
                      <td style={{ ...td, textAlign: "right", fontWeight: 700, color: "#10b981" }}>{fmt(filteredEntries.reduce((s, e) => s + e.amount, 0))}</td>
                      <td style={td}></td>
                    </tr>
                  </tfoot>
                )}
              </table>
            </div>
          </div>
        )}

        {/* HLAVNA KNIHA */}
        {tab === "kniha" && (
          <div>
            <div style={{ fontFamily: "'Playfair Display',serif", fontSize: 18, marginBottom: 16 }}>HlavnÃ¡ kniha â€” {year}</div>
            <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fill, minmax(280px, 1fr))", gap: 14 }}>
              {Object.values(ledger).filter(a => a.debit !== 0 || a.credit !== 0).map(acc => {
                const bal = balance(acc);
                return (
                  <div key={acc.code} style={{ background: "#0d1117", border: "1px solid #1f2937", borderRadius: 12, padding: 16, borderTop: `3px solid ${typeColor[acc.type]}` }}>
                    <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-start", marginBottom: 12 }}>
                      <div>
                        <div style={{ fontSize: 20, fontFamily: "'Playfair Display',serif", color: typeColor[acc.type] }}>{acc.code}</div>
                        <div style={{ fontSize: 12, color: "#9ca3af", marginTop: 2 }}>{acc.name}</div>
                      </div>
                      <Tag type={acc.type} />
                    </div>
                    <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: 6 }}>
                      {[{ l: "MD", v: fmt(acc.debit), c: "#4ade80" }, { l: "D", v: fmt(acc.credit), c: "#f472b6" }, { l: "Zostatok", v: fmt(Math.abs(bal)), c: bal >= 0 ? "#60a5fa" : "#f87171" }].map(x => (
                        <div key={x.l} style={{ textAlign: "center", background: "#1f2937", borderRadius: 6, padding: "6px 4px" }}>
                          <div style={{ color: "#6b7280", fontSize: 10, letterSpacing: 0.5 }}>{x.l}</div>
                          <div style={{ color: x.c, fontWeight: 700, marginTop: 2, fontSize: 12 }}>{x.v}</div>
                        </div>
                      ))}
                    </div>
                  </div>
                );
              })}
              {Object.values(ledger).filter(a => a.debit !== 0 || a.credit !== 0).length === 0 && (
                <div style={{ color: "#4b5563", textAlign: "center", padding: 50, gridColumn: "1/-1" }}>Å½iadne zÃ¡znamy</div>
              )}
            </div>
          </div>
        )}

        {/* â”€â”€ SÃšVAHA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
        {tab === "suvaha" && (() => {
          const rowsA = buildSuvahaRows(SA_ROWS, ledgerBez, vhp);
          const rowsP = buildSuvahaRows(SP_ROWS, ledgerBez, vhp);
          const totalA = rowsA.filter(r => r.lv === 0).reduce((s, r) => s + r.val, 0);
          const totalP = rowsP.filter(r => r.lv === 0).reduce((s, r) => s + r.val, 0);
          const diff = Math.abs(totalA - totalP);
          const company = "COFIM, s.r.o.";

          const SRow = ({ row, color }) => {
            const indent = row.lv === 0 ? 10 : row.lv === 1 ? 26 : 42;
            const bg     = row.lv === 0 ? "#0a0f1e" : row.lv === 1 ? "#0d1422" : "transparent";
            const fw     = row.lv < 2 ? 700 : 400;
            const fs     = row.lv === 0 ? 13 : 12;
            const showVal = row.val !== 0 || row.lv === 0;
            return (
              <tr style={{ background: bg, borderTop: row.lv === 0 ? "1px solid #1f2937" : "none" }}>
                <td style={{ ...td, color: "#4b5563", fontSize: 10, width: 58, whiteSpace: "nowrap" }}>{row.id}</td>
                <td style={{ ...td, paddingLeft: indent, fontWeight: fw, fontSize: fs }}>{row.label}</td>
                <td style={{ ...td, textAlign: "right", fontWeight: fw, fontSize: fs,
                  color: !showVal ? "#374151" : row.val < 0 ? "#f87171" : row.lv === 0 ? color : "#e5e7eb",
                  fontFamily: "'IBM Plex Mono',monospace" }}>
                  {showVal ? fmt(row.val) : "â€”"}
                </td>
              </tr>
            );
          };

          const SideTable = ({ rows, label, color }) => (
            <div style={{ background: "#0d1117", border: `1px solid ${color}33`, borderRadius: 10, overflow: "hidden" }}>
              <div style={{ padding: "9px 14px", background: color + "15", borderBottom: `1px solid ${color}33`,
                fontFamily: "'Playfair Display',serif", color, letterSpacing: 2, fontSize: 13 }}>
                {label}
              </div>
              <table style={{ width: "100%", borderCollapse: "collapse" }}>
                <thead style={{ background: "#070b12" }}>
                  <tr>
                    <th style={{ ...th, width: 58 }}>Riadok</th>
                    <th style={th}>PoloÅ¾ka</th>
                    <th style={{ ...th, textAlign: "right", width: 130 }}>Suma (â‚¬)</th>
                  </tr>
                </thead>
                <tbody>
                  {rows.map(r => <SRow key={r.id} row={r} color={color} />)}
                </tbody>
                <tfoot>
                  <tr style={{ background: color + "22", borderTop: `2px solid ${color}66` }}>
                    <td colSpan={2} style={{ ...td, color, fontWeight: 700, textTransform: "uppercase", fontSize: 11, letterSpacing: 1 }}>{label} SPOLU</td>
                    <td style={{ ...td, textAlign: "right", color, fontWeight: 700, fontSize: 16, fontFamily: "'IBM Plex Mono',monospace" }}>{fmt(label === "AKTÃVA" ? totalA : totalP)}</td>
                  </tr>
                </tfoot>
              </table>
            </div>
          );

          return (
            <div>
              <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 14, flexWrap: "wrap", gap: 8 }}>
                <span style={{ fontFamily: "'Playfair Display',serif", fontSize: 18 }}>SÃºvaha â€” {year}</span>
                <div style={{ display: "flex", gap: 8 }}>
                  <button onClick={() => printVykaz("suvaha", year, company, rowsA, rowsP, null)}
                    style={btn("#374151")}>ğŸ–¨ TlaÄ / PDF</button>
                  <button onClick={() => exportExcel(rowsA, rowsP, buildVzsRows(ledgerBez), year, company)}
                    style={btn("#14532d")}>ğŸ“Š Export Excel</button>
                </div>
              </div>
              <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 14 }}>
                <SideTable rows={rowsA} label="AKTÃVA" color="#4ade80" />
                <SideTable rows={rowsP} label="PASÃVA" color="#f472b6" />
              </div>
              <div style={{ marginTop: 12, padding: 13, background: "#0d1117", border: "1px solid #1f2937",
                borderRadius: 10, display: "flex", justifyContent: "center", gap: 28, flexWrap: "wrap", fontSize: 13 }}>
                <span style={{ color: "#6b7280" }}>AktÃ­va: <strong style={{ color: "#4ade80" }}>{fmt(totalA)} â‚¬</strong></span>
                <span style={{ color: "#6b7280" }}>PasÃ­va: <strong style={{ color: "#f472b6" }}>{fmt(totalP)} â‚¬</strong></span>
                <span style={{ fontWeight: 700, color: diff < 0.01 ? "#10b981" : "#f87171" }}>
                  {diff < 0.01 ? "âœ“ Bilancia sÃºhlasÃ­" : `âš  Rozdiel: ${fmt(diff)} â‚¬`}
                </span>
              </div>
            </div>
          );
        })()}

        {/* â”€â”€ VÃKAZ ZISKOV A STRÃT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
        {tab === "vysledovka" && (() => {
          const vzsRows = buildVzsRows(ledgerBez);
          const company = "COFIM, s.r.o.";

          const sectionTypes = new Set(["SUBTV","SUBTN","VHH","VHF","VHB","SUBTVF","SUBTNF","VHM","TOTAL","MARZA"]);
          const isSection = (type) => sectionTypes.has(type);

          const rowBg = (type) => {
            if (type === "TOTAL") return "#0f2a1a";
            if (type === "VHH" || type === "VHB") return "#0d2010";
            if (type === "SUBTV" || type === "SUBTVF") return "#0d1a2e";
            if (type === "SUBTN" || type === "SUBTNF") return "#1f0d0d";
            if (type === "VHF" || type === "VHM") return "#111a0d";
            if (type === "MARZA") return "#0d1117";
            return "transparent";
          };
          const rowColor = (type, val) => {
            if (type === "TOTAL" || type === "VHH" || type === "VHB" || type === "VHF" || type === "VHM")
              return val >= 0 ? "#10b981" : "#ef4444";
            if (type === "SUBTV" || type === "SUBTVF") return "#60a5fa";
            if (type === "SUBTN" || type === "SUBTNF") return "#f87171";
            if (type === "MARZA") return "#a3e635";
            if (type === "V" || type === "VF" || type === "VM") return "#93c5fd";
            return "#e5e7eb";
          };

          return (
            <div>
              <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 14, flexWrap: "wrap", gap: 8 }}>
                <span style={{ fontFamily: "'Playfair Display',serif", fontSize: 18 }}>VÃ½kaz ziskov a strÃ¡t â€” {year}</span>
                <div style={{ display: "flex", gap: 8 }}>
                  <button onClick={() => printVykaz("vzs", year, company, null, null, vzsRows)}
                    style={btn("#374151")}>ğŸ–¨ TlaÄ / PDF</button>
                  <button onClick={() => exportExcel(buildSuvahaRows(SA_ROWS, ledgerBez, vhp), buildSuvahaRows(SP_ROWS, ledgerBez, vhp), vzsRows, year, company)}
                    style={btn("#14532d")}>ğŸ“Š Export Excel</button>
                </div>
              </div>
              <div style={{ background: "#0d1117", border: "1px solid #1f2937", borderRadius: 12, overflow: "hidden" }}>
                <table style={{ width: "100%", borderCollapse: "collapse" }}>
                  <thead style={{ background: "#070b12" }}>
                    <tr>
                      <th style={{ ...th, width: 48 }}>Riad.</th>
                      <th style={th}>PoloÅ¾ka vÃ½kazu</th>
                      <th style={{ ...th, textAlign: "right", width: 140 }}>Suma (â‚¬)</th>
                    </tr>
                  </thead>
                  <tbody>
                    {vzsRows.map(row => {
                      const sec = isSection(row.type);
                      const borderT = sec ? "1px solid #1f2937" : "none";
                      const fs = sec ? 13 : 12;
                      const fw = sec ? 700 : 400;
                      const indent = sec ? 10 : 26;
                      const color = rowColor(row.type, row.val);
                      const showVal = row.val !== 0 || sec;
                      return (
                        <tr key={row.id} style={{ background: rowBg(row.type), borderTop: borderT }}>
                          <td style={{ ...td, color: "#4b5563", fontSize: 10 }}>{sec ? "" : row.id}</td>
                          <td style={{ ...td, fontWeight: fw, fontSize: fs, paddingLeft: indent }}>{row.label}</td>
                          <td style={{ ...td, textAlign: "right", fontWeight: fw, fontSize: sec ? 14 : 12,
                            color, fontFamily: "'IBM Plex Mono',monospace" }}>
                            {showVal ? fmt(row.val) : "â€”"}
                          </td>
                        </tr>
                      );
                    })}
                  </tbody>
                </table>
              </div>
            </div>
          );
        })()}


        
        {tab === "zahajovacia" && (
          <div>
            <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 16 }}>
              <span style={{ fontFamily: "'Playfair Display',serif", fontSize: 18 }}>OtvÃ¡racie zostatky â€” {year}</span>
              <button onClick={() => setModal("opening")} style={btn("#6366f1")}>+ PridaÅ¥ zostatok</button>
            </div>
            <div style={{ borderRadius: 12, overflow: "hidden", border: "1px solid #1f2937" }}>
              <table style={{ width: "100%", borderCollapse: "collapse" }}>
                <thead style={{ background: "#0d1117" }}>
                  <tr>{["ÃšÄet","NÃ¡zov","Typ","MD (â‚¬)","D (â‚¬)","Zostatok (â‚¬)"].map(h => <th key={h} style={th}>{h}</th>)}</tr>
                </thead>
                <tbody>
                  {Object.entries(yearData.openingBalances ?? {}).map(([code, v]) => {
                    const acc = ACCOUNT_CHART.find(a => a.code === code);
                    const bal = (acc?.type === "A" || acc?.type === "N") ? v.debit - v.credit : v.credit - v.debit;
                    return (
                      <tr key={code}>
                        <td style={{ ...td, color: "#9ca3af" }}>{code}</td>
                        <td style={td}>{acc?.name ?? "â€”"}</td>
                        <td style={td}>{acc && <Tag type={acc.type} />}</td>
                        <td style={{ ...td, textAlign: "right", color: "#4ade80" }}>{fmt(v.debit)}</td>
                        <td style={{ ...td, textAlign: "right", color: "#f472b6" }}>{fmt(v.credit)}</td>
                        <td style={{ ...td, textAlign: "right", fontWeight: 700, color: "#60a5fa" }}>{fmt(bal)}</td>
                      </tr>
                    );
                  })}
                  {Object.keys(yearData.openingBalances ?? {}).length === 0 && (
                    <tr><td colSpan={6} style={{ ...td, color: "#4b5563", textAlign: "center", padding: 40 }}>Å½iadne otvÃ¡racie zostatky</td></tr>
                  )}
                </tbody>
              </table>
            </div>
          </div>
        )}
      </div>

      {/* â”€â”€ AI IMPORT MODALS â”€â”€ */}
      {modal === "importPdf" && <PdfImportModal onClose={() => setModal(null)} onImport={handleAiImport} inp={inp} btn={btn} />}
      {modal === "importXml" && <XmlImportModal onClose={() => setModal(null)} onImport={handleAiImport} inp={inp} btn={btn} />}

      {/* â”€â”€ STANDARD MODALS â”€â”€ */}
      {modal === "entry" && (() => {
        const selCat = CAT_BY_ID[form.categoryId];
        const isManual = !form.categoryId || form.categoryId === "manual";
        const groups = [...new Set(CATEGORIES.map(c => c.group))];
        const lbl = (text, color) => (
          <label style={{ display: "block", fontSize: 11, color: color || "#9ca3af", marginBottom: 4, letterSpacing: 1, textTransform: "uppercase" }}>{text}</label>
        );
        const onCatChange = (id) => {
          const cat = CAT_BY_ID[id];
          if (!cat) return;
          setForm(x => ({
            ...x,
            categoryId: id,
            debitAcc:  cat.debit  || x.debitAcc,
            creditAcc: cat.credit || x.creditAcc,
            description: cat.descPrefix && !x.description ? cat.descPrefix : x.description,
          }));
        };
        return (
          <Modal title={form.editId ? "âœï¸ UpraviÅ¥ zÃ¡pis" : "â• NovÃ½ doklad"} onClose={() => { setForm({ date: today(), description: "", debitAcc: "", creditAcc: "", amount: "" }); setModal(null); }}>

            {/* KATEGÃ“RIA */}
            <div style={{ marginBottom: 16 }}>
              {lbl("KategÃ³ria dokladu")}
              <select value={form.categoryId || ""} onChange={e => onCatChange(e.target.value)} style={{ ...inp, fontWeight: 600 }}>
                <option value="">â€” vybraÅ¥ kategÃ³riu â€”</option>
                {groups.map(g => (
                  <optgroup key={g} label={g}>
                    {CATEGORIES.filter(c => c.group === g).map(c => (
                      <option key={c.id} value={c.id}>{c.label}</option>
                    ))}
                  </optgroup>
                ))}
              </select>
            </div>

            {/* Ak je vybranÃ¡ kategÃ³ria â€” zobraziÅ¥ preview ÃºÄtov */}
            {selCat && selCat.id !== "manual" && (
              <div style={{ marginBottom: 16, padding: "10px 14px", background: "#0d1a2e", border: "1px solid #1e3a5f", borderRadius: 8, display: "flex", gap: 10, alignItems: "center", flexWrap: "wrap" }}>
                <span style={{ fontSize: 11, color: "#6b7280" }}>AutomatickÃ© ÃºÄtovanie:</span>
                <span style={{ color: "#4ade80", fontWeight: 700, fontFamily: "monospace" }}>MD {selCat.debit}</span>
                <span style={{ color: "#374151" }}>â†’</span>
                <span style={{ color: "#f472b6", fontWeight: 700, fontFamily: "monospace" }}>D {selCat.credit}</span>
                <button onClick={() => setForm(x => ({ ...x, categoryId: "manual" }))}
                  style={{ marginLeft: "auto", background: "none", border: "1px solid #374151", color: "#9ca3af", borderRadius: 4, padding: "2px 8px", fontSize: 11, cursor: "pointer" }}>
                  ZmeniÅ¥ ÃºÄty
                </button>
              </div>
            )}

            {/* DÃTUM + POPIS */}
            <div style={{ display: "grid", gridTemplateColumns: "140px 1fr", gap: 10, marginBottom: 14 }}>
              <div>
                {lbl("DÃ¡tum")}
                <input type="date" value={form.date} onChange={e => setForm(x => ({ ...x, date: e.target.value }))} style={inp} />
              </div>
              <div>
                {lbl("Popis / ÄÃ­slo dokladu")}
                <input type="text" value={form.description} placeholder="Napr. FAV 2024/001" onChange={e => setForm(x => ({ ...x, description: e.target.value }))} style={inp} />
              </div>
            </div>

            {/* ÃšÄŒTY â€” zobrazenÃ© len ak manuÃ¡lne alebo na zmenu */}
            {isManual && (
              <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10, marginBottom: 14 }}>
                {[{ label: "MD ÃºÄet (MÃ¡ daÅ¥)", key: "debitAcc", color: "#4ade80" }, { label: "D ÃºÄet (Dal)", key: "creditAcc", color: "#f472b6" }].map(f => (
                  <div key={f.key}>
                    {lbl(f.label, f.color)}
                    <select value={form[f.key]} onChange={e => setForm(x => ({ ...x, [f.key]: e.target.value }))} style={inp}>
                      <option value="">â€” vybraÅ¥ â€”</option>
                      {ACCOUNT_CHART.map(a => <option key={a.code} value={a.code}>{a.code} â€“ {a.name}</option>)}
                    </select>
                  </div>
                ))}
              </div>
            )}

            {/* SUMA */}
            <div style={{ marginBottom: 20 }}>
              {lbl("Suma (â‚¬)")}
              <input type="number" value={form.amount} placeholder="0.00" min="0" step="0.01"
                onChange={e => setForm(x => ({ ...x, amount: e.target.value }))} style={{ ...inp, fontSize: 18, fontWeight: 700 }} />
            </div>

            <div style={{ display: "flex", justifyContent: "flex-end", gap: 10 }}>
              <button onClick={() => { setForm({ date: today(), description: "", debitAcc: "", creditAcc: "", amount: "" }); setModal(null); }} style={btn("#374151")}>ZruÅ¡iÅ¥</button>
              <button onClick={addEntry} style={btn(form.editId ? "#6366f1" : "#10b981")}>
                {form.editId ? "âœ“ UloÅ¾iÅ¥ zmeny" : "âœ“ ZaÃºÄtovaÅ¥"}
              </button>
            </div>
          </Modal>
        );
      })()}

      {modal === "newYear" && (
        <Modal title="NovÃ½ ÃºÄtovnÃ½ rok" onClose={() => setModal(null)}>
          <div style={{ marginBottom: 20 }}>
            <label style={{ display: "block", fontSize: 11, color: "#9ca3af", marginBottom: 4, letterSpacing: 1, textTransform: "uppercase" }}>Rok</label>
            <input type="number" value={newYearVal} placeholder="napr. 2025" onChange={e => setNewYearVal(e.target.value)} style={inp} />
          </div>
          <div style={{ display: "flex", justifyContent: "flex-end", gap: 10 }}>
            <button onClick={() => setModal(null)} style={btn("#374151")}>ZruÅ¡iÅ¥</button>
            <button onClick={createYear} style={btn("#6366f1")}>VytvoriÅ¥ rok</button>
          </div>
        </Modal>
      )}

      {modal === "opening" && (
        <Modal title="OtvÃ¡racie zostatky" onClose={() => setModal(null)}>
          <div style={{ marginBottom: 14 }}>
            <label style={{ display: "block", fontSize: 11, color: "#9ca3af", marginBottom: 4, letterSpacing: 1, textTransform: "uppercase" }}>ÃšÄet</label>
            <select value={openingAcc.code} onChange={e => setOpeningAcc(x => ({ ...x, code: e.target.value }))} style={inp}>
              <option value="">â€” vybraÅ¥ â€”</option>
              {ACCOUNT_CHART.map(a => <option key={a.code} value={a.code}>{a.code} â€“ {a.name}</option>)}
            </select>
          </div>
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 12, marginBottom: 20 }}>
            {[{ label: "MD zostatok (â‚¬)", key: "debit", color: "#4ade80" }, { label: "D zostatok (â‚¬)", key: "credit", color: "#f472b6" }].map(f => (
              <div key={f.key}>
                <label style={{ display: "block", fontSize: 11, color: f.color, marginBottom: 4, letterSpacing: 1, textTransform: "uppercase" }}>{f.label}</label>
                <input type="number" value={openingAcc[f.key]} placeholder="0.00" onChange={e => setOpeningAcc(x => ({ ...x, [f.key]: e.target.value }))} style={inp} />
              </div>
            ))}
          </div>
          <div style={{ display: "flex", justifyContent: "flex-end", gap: 10 }}>
            <button onClick={() => setModal(null)} style={btn("#374151")}>ZruÅ¡iÅ¥</button>
            <button onClick={saveOpening} style={btn("#6366f1")}>UloÅ¾iÅ¥ zostatok</button>
          </div>
        </Modal>
      )}

      {modal === "ocr" && (
        <OcrModal
          onClose={() => setModal(null)}
          onConfirm={(entry) => {
            setForm(entry);
            setModal("entry");
          }}
          inp={inp}
          btn={btn}
          year={year}
        />
      )}

      {modal === "importJson" && (
        <Modal title="Import (JSON)" onClose={() => setModal(null)}>
          <div style={{ marginBottom: 10, fontSize: 12, color: "#9ca3af" }}>
            FormÃ¡t: <code style={{ color: "#60a5fa", fontSize: 11 }}>{`{ "year": "2023", "entries": [...], "openingBalances": {...} }`}</code>
          </div>
          <textarea value={importText} onChange={e => setImportText(e.target.value)}
            rows={10} placeholder='{ "year": "2023", "entries": [], "openingBalances": {} }'
            style={{ ...inp, resize: "vertical", marginBottom: 16, fontSize: 12 }} />
          <div style={{ display: "flex", justifyContent: "flex-end", gap: 10 }}>
            <button onClick={() => setModal(null)} style={btn("#374151")}>ZruÅ¡iÅ¥</button>
            <button onClick={doImport} style={btn("#f59e0b")}>â¬† ImportovaÅ¥</button>
          </div>
        </Modal>
      )}
    </div>
  );
}function loadSheetJS(cb) {
  if (window.XLSX) { cb(window.XLSX); return; }
  const s = document.createElement("script");
  s.src = "https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js";
  s.onload = () => cb(window.XLSX);
  s.onerror = () => alert("Nepodarilo sa naÄÃ­taÅ¥ SheetJS.");
  document.head.appendChild(s);
}

function exportToExcel(suvahaRows, vzsRows, year) {
  loadSheetJS((XLSX) => {
    const wb = XLSX.utils.book_new();
    if (suvahaRows.length > 0) {
      const rows = [
        ["SÃšVAHA k 31.12." + year],
        ["COFIM, s.r.o., Obrancov mieru 361/12, 01501 Rajec"],
        [""],
        ["Riadok", "PoloÅ¾ka", "Suma (â‚¬)"],
        ...suvahaRows.map(r => [r.id || "", r.label || "", r.value != null ? +r.value.toFixed(2) : ""])
      ];
      const ws = XLSX.utils.aoa_to_sheet(rows);
      ws["!cols"] = [{wch:8},{wch:50},{wch:18}];
      XLSX.utils.book_append_sheet(wb, ws, "SÃºvaha");
    }
    if (vzsRows.length > 0) {
      const rows = [
        ["VÃKAZ ZISKOV A STRÃT za rok " + year],
        ["COFIM, s.r.o., Obrancov mieru 361/12, 01501 Rajec"],
        [""],
        ["Riadok", "PoloÅ¾ka", "Suma (â‚¬)"],
        ...vzsRows.map(r => [r.id || "", r.label || "", r.value != null ? +r.value.toFixed(2) : ""])
      ];
      const ws = XLSX.utils.aoa_to_sheet(rows);
      ws["!cols"] = [{wch:8},{wch:52},{wch:18}];
      XLSX.utils.book_append_sheet(wb, ws, "VZS");
    }
    // base64 data URI â€” works in sandboxed iframes
    const b64 = XLSX.write(wb, { bookType: "xlsx", type: "base64" });
    const uri = "data:application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;base64," + b64;
    const a = document.createElement("a");
    a.href = uri;
    a.download = "COFIM_" + year + "_vykazy.xlsx";
    a.click();
  });
}

function printReport(type, year) {
  const el = document.getElementById("print-" + type);
  if (!el) { alert("Element nenÃ¡jdenÃ½: print-" + type); return; }
  const title = type === "suvaha"
    ? "S\u00favaha k 31.12." + year
    : "V\u00fdkaz ziskov a str\u00e1t za rok " + year;
  const css = [
    "body{font-family:Arial,sans-serif;font-size:11px;margin:20px;color:#000}",
    "h2{font-size:13px;font-weight:bold;margin:0 0 3px}",
    "h4{font-size:10px;font-weight:normal;color:#555;margin:0 0 14px}",
    "table{width:100%;border-collapse:collapse}",
    "th{background:#eee;border:1px solid #bbb;padding:4px 7px;font-size:10px;text-align:left}",
    "td{border:1px solid #ddd;padding:3px 7px;font-size:11px}",
    ".r{text-align:right;font-family:monospace}",
    "@page{margin:15mm}@media print{body{margin:0}}"
  ].join("");
  const html = "<!DOCTYPE html><html><head><meta charset='utf-8'><title>" + title + "</title>" +
    "<style>" + css + "</style></head><body>" +
    "<h2>" + title + "</h2>" +
    "<h4>COFIM, s.r.o. | O\u010drancov mieru 361/12, 01501 Rajec</h4>" +
    el.innerHTML + "</body></html>";
  const encoded = "data:text/html;charset=utf-8," + encodeURIComponent(html);
  const a = document.createElement("a");
  a.href = encoded;
  a.download = (type === "suvaha" ? "Suvaha" : "VZS") + "_" + year + ".html";
  a.click();
}

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>